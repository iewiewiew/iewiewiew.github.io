<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Chaos/ChaosBlade">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">ChaosBlade | 知行合一</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://iewiewiew.github.io/img/me.jpeg"><meta data-rh="true" name="twitter:image" content="https://iewiewiew.github.io/img/me.jpeg"><meta data-rh="true" property="og:url" content="https://iewiewiew.github.io/docs/Chaos/ChaosBlade"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ChaosBlade | 知行合一"><meta data-rh="true" name="description" content="[TOC]"><meta data-rh="true" property="og:description" content="[TOC]"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://iewiewiew.github.io/docs/Chaos/ChaosBlade"><link data-rh="true" rel="alternate" href="https://iewiewiew.github.io/docs/Chaos/ChaosBlade" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://iewiewiew.github.io/docs/Chaos/ChaosBlade" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZNU4NQPM1V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="知行合一" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0ebb5d40.css">
<link rel="preload" href="/assets/js/runtime~main.cbea1bda.js" as="script">
<link rel="preload" href="/assets/js/main.904b21c1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/me.jpeg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/me.jpeg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">wei</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">目录</a><a href="https://www.processon.com/mindmap/6138112f1e085306ef9fe608" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">技能图谱<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/iewiewiew" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">README</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/AI/">AI</a><button aria-label="打开/收起侧边栏菜单「AI」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/CSBasic/Network">CSBasic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Chaos/ChaosBlade">Chaos</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Chaos/ChaosBlade">ChaosBlade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Chaos/ChaosMesh">ChaosMesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Chaos/混沌工程">混沌工程</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Database/ClickHouse/">Database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/DevOps/">DevOps</a><button aria-label="打开/收起侧边栏菜单「DevOps」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Git/">Git</a><button aria-label="打开/收起侧边栏菜单「Git」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Linux/">Linux</a><button aria-label="打开/收起侧边栏菜单「Linux」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Middleware/Apollo/">Middleware</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Mixinfo/BigData/大数据">Mixinfo</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/SoftwareTest/AppTest">SoftwareTest</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Chaos</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ChaosBlade</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>ChaosBlade</h1></header><p>[TOC]</p><h1 align="center">ChaosBlade</h1><blockquote><p>By：weimenghua<br>
<!-- -->Date：2022.11.20<br>
<!-- -->Description：Chaosblade 混沌工程实验工具</p></blockquote><p><strong>参考资料</strong><br>
<a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">ChaosBlade 官网</a><br>
<a href="https://chaosblade-io.gitbook.io/chaosblade-help-zh-cn/" target="_blank" rel="noopener noreferrer">ChaosBlade 文档</a><br>
<a href="https://github.com/chaosblade-io" target="_blank" rel="noopener noreferrer">ChaosBlade 源码</a><br>
<a href="https://github.com/chaosblade-io/awesome-chaosblade" target="_blank" rel="noopener noreferrer">awesome-chaosblade</a><br>
<a href="https://github.com/dastergon/awesome-chaos-engineering" target="_blank" rel="noopener noreferrer">awesome-chaos-engineering</a>  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-chaosblade-入门">1. ChaosBlade 入门<a href="#1-chaosblade-入门" class="hash-link" aria-label="1. ChaosBlade 入门的直接链接" title="1. ChaosBlade 入门的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-chaosblade-简介">1.1 ChaosBlade 简介<a href="#11-chaosblade-简介" class="hash-link" aria-label="1.1 ChaosBlade 简介的直接链接" title="1.1 ChaosBlade 简介的直接链接">​</a></h3><p>ChaosBlade 是阿里巴巴 2019 年开源的混沌工程项目，包含混沌工程实验工具 chaosblade 和混沌工程平台 chaosblade-box，旨在通过混沌工程帮助企业解决云原生过程中高可用问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-chaosblade-架构">1.2 ChaosBlade 架构<a href="#12-chaosblade-架构" class="hash-link" aria-label="1.2 ChaosBlade 架构的直接链接" title="1.2 ChaosBlade 架构的直接链接">​</a></h3><p>ChaosBlade 支持多种环境部署与演练，包括 linux、docker、kubernetes 集群及各类云厂商环境。ChaosBlade 主要包括以下几个组件：</p><ul><li>ChaosBlade-Box Console：ChaosBlade 可视化组件，主要提供一套用户友好的 Web 界面，用户可以通过该界面进行混沌工程实验的编排与操作管理。</li><li>ChaosBlade-Box Server：核心逻辑组件，主要负责混沌工程实验的管理与编排，探针与应用管理。包括组件，Chaos Engine：演练引擎，包括流程编排、安全管控、演练报告等功能；Chaos Runner：演练执行器，兼容多种执行工具；Chaos Experinece：演练经验库等。</li><li>Agent：核心逻辑组件，部署在用户终端的主机或 Kubernetes 集群内，主要负责和 ChaosBlade-Box Server 建联上报心跳并作为命令下发通道。</li><li>ChaosBlade：主要执行工具，能在主机和 Kubernetes 等不同环境上执行故障注入，能对系统网络设备、文件系统、内核及系统上运行的应用等进行故障干扰。</li></ul><p><img loading="lazy" alt="chaosblade 架构" src="/assets/images/chaosblade-architect-699b518b40fe6e3eeb1e50e156bf9e57.png" width="2434" height="1964" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-chaosblade-搭建">2. ChaosBlade 搭建<a href="#2-chaosblade-搭建" class="hash-link" aria-label="2. ChaosBlade 搭建的直接链接" title="2. ChaosBlade 搭建的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-chaosblade-搭建">2.1 ChaosBlade 搭建<a href="#21-chaosblade-搭建" class="hash-link" aria-label="2.1 ChaosBlade 搭建的直接链接" title="2.1 ChaosBlade 搭建的直接链接">​</a></h3><p><a href="https://github.com/chaosblade-io/chaosblade/releases" target="_blank" rel="noopener noreferrer">ChaosBlade 下载地址</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">方式一</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/chaosblade-io/chaosblade/releases/download/v1.7.1/chaosblade-1.7.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">方式二</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://chaosblade.oss-cn-hangzhou.aliyuncs.com/agent/github/1.7.1/chaosblade-1.7.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf chaosblade-1.7.1-linux-amd64.tar.gz &amp;&amp; cd chaosblade-1.7.1/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s `pwd`/blade /usr/local/bin/blade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5、帮助</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6、卸载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf chaosblade-*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7、设置 blade 别名 b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt;&gt; ~/.bashrc &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias b=&#x27;blade&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat ~/.bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-chaosblade-operator-搭建">2.2 ChaosBlade Operator 搭建<a href="#22-chaosblade-operator-搭建" class="hash-link" aria-label="2.2 ChaosBlade Operator 搭建的直接链接" title="2.2 ChaosBlade Operator 搭建的直接链接">​</a></h3><p><a href="https://github.com/chaosblade-io/chaosblade-operator/releases" target="_blank" rel="noopener noreferrer">ChaosBlade Operator 下载地址</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/chaosblade-io/chaosblade-operator/releases/download/v1.7.1/chaosblade-operator-1.7.1.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install chaosblade-operator chaosblade-operator-1.7.1.tgz --namespace chaosblade --create-namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注：未实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install chaosblade-operator chaosblade-operator-1.7.1.tgz --namespace chaosblade --set blade.repository=chaosbladeio/chaosblade-tool,operator.repository=chaosbladeio/chaosblade-operator </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、验证（有几个 node 就有几个 tool）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、卸载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall chaosblade-operator -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除 crd 资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete crd chaosblades.chaosblade.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如果 crd 资源删除长时间没有成功，可通过以下命令进行删除：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blades=$(kubectl get blade | grep -v NAME | awk &#x27;{print $1}&#x27; | tr &#x27;\n&#x27; &#x27; &#x27;) &amp;&amp; kubectl patch blade $blades --type merge -p &#x27;{&quot;metadata&quot;:{&quot;finalizers&quot;:[]}}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">停止全部实验，删除所有创建的资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm del --purge chaosblade-operator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-chaosblade-box-搭建">2.3 ChaosBlade Box 搭建<a href="#23-chaosblade-box-搭建" class="hash-link" aria-label="2.3 ChaosBlade Box 搭建的直接链接" title="2.3 ChaosBlade Box 搭建的直接链接">​</a></h3><p><a href="https://github.com/chaosblade-io/chaosblade-box" target="_blank" rel="noopener noreferrer">ChaosBlade Box 下载地址</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、下载 chaosblade-box</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/chaosblade-io/chaosblade-box/releases/download/v1.0.3/chaosblade-box-1.0.3.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、安装 chaosblade-box</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install chaosblade-box chaosblade-box-1.0.3.tgz --namespace chaosblade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set spring.datasource.password=DATASOURCE_PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、查看 pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod 详细信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod `kubectl get pod -n chaosblade |grep chaosblade-box |awk -F &quot; &quot; &#x27;NR==1{print $1}&#x27;` -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、查看 svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5、查看日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f `kubectl get pod -n chaosblade |grep chaosblade-box |awk -F &quot; &quot; &#x27;NR==1{print $1}&#x27;` -n chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6、验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">执行 kubectl get svc -n chaosblade 拿到端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">访问 http://127.0.0.1:32179/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注册一个账号，设置账号密码：root/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7、卸载 chaosblade-box</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall chaosblade-box -n chaosblade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ChaosBlade Box 页面</strong></p><p><img loading="lazy" alt="chaosblade" src="/assets/images/chaosblade-fe2653bcc71cf827cb8c642300034d1f.png" width="1512" height="749" class="img_ev3q"></p><p><strong>安装探针</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、Helm chart 包下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://chaosblade.oss-cn-hangzhou.aliyuncs.com/platform/release/1.0.2/chaosblade-box-agent-1.0.2.tgz -O chaos.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、Helm v3 安装探针（查看 helm 版本：helm version）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：helm install agent chaos.tgz --namespace chaosblade --set env.name=default,license=aa0ec9b38ac0411593883bc643458d74,images.chaos.repository=chaosbladeio/chaosblade-agent,images.chaos.version=1.0.2,transport.endpoint={替换为 box 的 ip:port},controller.cluster_id={替换为集群 id，取值无特殊要求},controller.cluster_name={替换为集群名字，取值无特殊要求}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看集群名称：kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 box 的 ip:port：kubectl get svc -n chaosblade |grep chaosblade-box |grep 7001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 cluster_id：kubectl get configmap cluster-info -n kube-public -o json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：helm install agent chaos.tgz --namespace chaosblade --set env.name=default,license=aa0ec9b38ac0411593883bc643458d74,images.chaos.repository=chaosbladeio/chaosblade-agent,images.chaos.version=1.0.2,transport.endpoint=10.43.194.110:7001,controller.cluster_id=0a6910e9-4948-49a8-b896-026c84dd02f6,controller.cluster_name=k8s-master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、卸载 agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall agent -n chaosblade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-chaosblade-实验">3. ChaosBlade 实验<a href="#3-chaosblade-实验" class="hash-link" aria-label="3. ChaosBlade 实验的直接链接" title="3. ChaosBlade 实验的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-chaosblade-场景">3.1 ChaosBlade 场景<a href="#31-chaosblade-场景" class="hash-link" aria-label="3.1 ChaosBlade 场景的直接链接" title="3.1 ChaosBlade 场景的直接链接">​</a></h3><p><img loading="lazy" src="/assets/images/chaosblade-scene-2389b1bbbbbb36654a20c9a6bd25d5d6.png" width="2078" height="1220" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ck          Clickhouse experiment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cplus       C++ chaos experiments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpu         Cpu experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cri         CRI experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disk        Disk experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker      Docker experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">druid       Experiment with the Druid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo       Experiment with the Dubbo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">es          ElasticSearch experiment!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feign       feign experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file        File experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gateway     gateway experiment!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbase       hbase experiment!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http        http experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jedis       jedis experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jvm         Experiment with the JVM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s         Kubernetes experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka       kafka experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lettuce     redis client lettuce experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log         log experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mem         Mem experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodb     MongoDB experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql       mysql experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network     Network experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process     Process experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">psql        Postgrelsql experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq    rabbitmq experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redisson    redisson experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rocketmq    Rocketmq experiment,can make message send or pull delay and exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script      Script chaos experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">servlet     java servlet experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strace      strace experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemd     Systemd experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tars        tars experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time        Time experiment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zk          zk experiment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-chaosblade-基础">3.2 ChaosBlade 基础<a href="#32-chaosblade-基础" class="hash-link" aria-label="3.2 ChaosBlade 基础的直接链接" title="3.2 ChaosBlade 基础的直接链接">​</a></h3><p><strong>参考资料</strong><br>
<a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">ChaosBlade 官网</a><br>
<a href="https://chaosblade-io.gitbook.io/chaosblade-help-zh-cn/" target="_blank" rel="noopener noreferrer">ChaosBlade 文档</a>   </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-demo">blade demo<a href="#blade-demo" class="hash-link" aria-label="blade demo的直接链接" title="blade demo的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、下载镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull chaosbladeio/chaosblade-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、运行 demo 容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">官方命令：docker run -it --privileged chaosbladeio/chaosblade-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">指定名称：docker run -it --privileged chaosbladeio/chaosblade-demo --name=chaosblade-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、查看进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker ps |grep chaosblade-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、进入容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it chaosblade-demo bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5、进入镜像之后，可阅读 README.md 文件实施混沌实验，Enjoy it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6、删除容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rm -f chaosblade-demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-base">blade base<a href="#blade-base" class="hash-link" aria-label="blade base的直接链接" title="blade base的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、blade check </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">该命令主要用于 Linux 主机上演练实验时，对主机环境进行校验，判断其是否满足 chaosblade 实验环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade check [command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade check os / blade check java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、blade create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">创建实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade create [command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade create cpu load --cpu-percent 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、blade destroy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">销毁实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">通过 UID 销毁 create 的实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade destroy [command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade destroy 64b361b56904546b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">通过 command 销毁 create 的实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade destroy &lt;command&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade destroy cpu fullload --cpu-count 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、blade prepare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">应用层场景在 create 注入之前，将应用层 agent 挂载到目标进程中，目前只有 Java 和C++应用层场景需要。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade prepare [command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：prepare jvm --process tomcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5、blade query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade query [command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade query 64b361b56904546b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade query k8s create &lt;UID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade query k8s create 64b361b56904546b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6、blade revoke</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">撤销实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade revoke &lt;UID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade revoke 64b361b56904546b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7、blade status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看实验信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：blade status &lt;UID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：blade status 64b361b56904546b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看某类型实验信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade status --type create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade status --type destroy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade status --type prepare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8、blade version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 blade 版本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">其它</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看所有实验 id（带双引号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade status --type create |jq &#x27;.result[].Uid&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看所有实验 id（不带双引号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade status --type create |jq -r &#x27;.result[].Uid&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-server">blade server<a href="#blade-server" class="hash-link" aria-label="blade server的直接链接" title="blade server的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">在 server 模式下，blade 程序会对外暴露 web 服务，上层可通过 http 请求调用，请求格式是 chaosblade?cmd=具体命令，例如执行 CPU 满载，则请求是 chaosblade?cmd=create%20cpu%20fullload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">启动 server 模式，服务端口是 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade server start --port 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">停止 blade server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade server stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">触发实验场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://127.0.0.1:8080/chaosblade?cmd=create cpu load --cpu-percent 80 --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl &quot;http://127.0.0.1:8080/chaosblade?cmd=create%20cpu%20load%20--cpu-percent%2080%20--timeout%2060&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">销毁实验场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://127.0.0.1:8080/chaosblade?cmd=destroy e866e0cd3706ca72</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl &quot;http://127.0.0.1:8080/chaosblade?cmd=destroy%20e866e0cd3706ca72&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-chaosblade-实验">3.2 ChaosBlade 实验<a href="#32-chaosblade-实验" class="hash-link" aria-label="3.2 ChaosBlade 实验的直接链接" title="3.2 ChaosBlade 实验的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-cpu-load">blade create cpu load<a href="#blade-create-cpu-load" class="hash-link" aria-label="blade create cpu load的直接链接" title="blade create cpu load的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CPU 相关的混沌实验包含 CPU 满载，可以指定核数、具体核满载或者总 CPU 负载百分比。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">旨在 CPU 在特定负载下，验证服务质量、监控告警、流量调度、弹性伸缩等能力。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load、fullload、fl 命令都可以，即 blade create cpu load、blade create cpu fullload 或 blade create cpu fl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">执行命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load [flags]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string       设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-count string     指定 CPU 满载的个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-list string      指定 CPU 满载的具体核，核索引从 0 开始 (0-3 or 1,3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-percent string   指定 CPU 负载百分比，取值在 0-100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建 CPU 满载实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定随机两个核满载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load --cpu-count 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定索引是 0，3 的核满载，核的索引从 0 开始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load --cpu-list 0,3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定索引 1 到 3 的核满载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load --cpu-list 1-3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定百分比负载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load --cpu-percent 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create cpu load --cpu-percent 60 --timeout 30 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-disk-burn">blade create disk burn<a href="#blade-create-disk-burn" class="hash-link" aria-label="blade create disk burn的直接链接" title="blade create disk burn的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">提升磁盘读写 io 负载，可以指定受影响的目录，也可以通过调整读写的块大小提升 io 负载，默认值是 10，单位是 M，块的数量固定为 100，即在默认情况下，写会占用 1000M 的磁盘空间，读会固定占用 600M 的空间，因为读操作会先创建一个 600M 的固定大小文件，预计 3s 之内，在创建时写 io 会升高。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">验证磁盘 io 高负载下对系统服务的影响，比如监控告警、服务稳定性等。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--path string      指定提升磁盘 io 的目录，会作用于其所在的磁盘上，默认值是 /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--read             触发提升磁盘读 IO 负载，会创建 600M 的文件用于读，销毁实验会自动删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--size string      块大小, 单位是 M, 默认值是 10，一般不需要修改，除非想更大的提高 io 负载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string   设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--write            触发提升磁盘写 IO 负载，会根据块大小的值来写入一个文件，比如块大小是 10，则固定的块的数量是 100，则会创建 1000M 的文件，销毁实验会自动删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 主要观察 rkB/s、wkB/s、%util 数据。执行磁盘读 IO 负载高场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk burn --read --path /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 销毁上述实验后，执行磁盘写 IO 负载高场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk burn --write --path /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可同时执行读写 IO 负载场景，不指定 path，默认值是 /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk burn --read --write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk burn --read --write --path /home --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iostat -x -t 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-disk-fill">blade create disk fill<a href="#blade-create-disk-fill" class="hash-link" aria-label="blade create disk fill的直接链接" title="blade create disk fill的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">模拟磁盘填充，可以指定填充的目录和填充大小。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">验证磁盘满下对系统服务的影响，比如监控告警、服务稳定性等。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--path string      需要填充的目录，默认值是 /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--size string      需要填充的文件大小，单位是 M，取值是整数，例如 --size 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--reserve string   保留磁盘大小，单位是 MB。取值是不包含单位的正整数，例如 --reserve 1024。如果 size、percent、reserve 参数都存在，优先级是 percent &gt; reserve &gt; size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--percent string   指定磁盘使用率，取值是不带%号的正整数，例如 --percent 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--retain-handle    是否保留填充</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string   设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 执行磁盘填充，填充 40G，即达到磁盘满的效果（可用34G）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk fill --path /home --size 40000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 执行按百分比填充磁盘，并且保留填充磁盘的文件句柄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade c disk fill --path /home --percent 80 --retain-handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看文件句柄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsof /home/chaos_filldisk.log.dat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 执行保留固定大小实验场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade c disk fill --path /home --reserve 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk fill --path /home --size 40000 --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create disk fill --path /home --percent 80 --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h /home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">du -sh * | sort -n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-mem-load">blade create mem load<a href="#blade-create-mem-load" class="hash-link" aria-label="blade create mem load的直接链接" title="blade create mem load的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">指定内存占用，注意，此场景触发内存占用满，即使指定了 --timeout 参数，也可能出现通过 blade 工具无法恢复的情况，可通过重启机器解决！！！推荐指定内存百分比！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">由于目前内存大小计算通过 memory.stat 等文件计算，所以和 free 命令计算不一致，同 top 命令一致，验证时请使用 top 命令查看内存使用。后续会针对内存占用场景进行优化。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--mem-percent string    内存使用率，取值是 0 到 100 的整数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--mode string   内存占用模式，有 ram 和 cache 两种，例如 --mode ram。ram 采用代码实现，可控制占用速率，优先推荐此模式；cache 是通过挂载 tmpfs 实现；默认值是 --mode cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--reserve string    保留内存的大小，单位是 MB，如果 mem-percent 参数存在，则优先使用 mem-percent 参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--rate string 内存占用速率，单位是 MB/S，仅在 --mode ram 时生效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string   设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 执行内存占用 50%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade c mem load --mode ram --mem-percent 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 保留 200M 内存，总内存大小 1G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade c mem load --mode ram --reserve 200 --rate 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create mem load --mode ram --mem-percent 80 --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">free -m / top</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-network-delay">blade create network delay<a href="#blade-create-network-delay" class="hash-link" aria-label="blade create network delay的直接链接" title="blade create network delay的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">可以指定网卡、本地端口、远程端口、目标 IP 延迟。需要特别注意，如果不指定端口、ip 参数，而是整个网卡延迟，切记要添加 --timeout 参数或者 --exclude-port 参数，前者是指定运行时间，自动停止销毁实验，后者是指定排除掉的延迟端口，两者都是防止因延迟时间设置太长，造成机器无法连接的情况，如果真实发生此问题，重启机器即可恢复。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">本地端口和远程端口之间是或的关系，即这两个端口都会发生延迟，只要指定了本地端口或者远程端口，无需指定需要排除的端口。端口与 IP 之间是与的关系，即指定的 IP:PORT 发生延迟。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">网络延迟场景主要验证网络异常的情况下，系统的自我容错能力。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--destination-ip string   目标 IP. 支持通过子网掩码来指定一个网段的 IP 地址, 例如 192.168.1.0/24. 则 192.168.1.0~192.168.1.255 都生效。你也可以指定固定的 IP，如 192.168.1.1 或者 192.168.1.1/32，也可以通过都号分隔多个参数，例如 192.168.1.1,192.168.2.1。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--exclude-port string     排除掉的端口，默认会忽略掉通信的对端端口，目的是保留通信可用。可以指定多个，使用逗号分隔或者连接符表示范围，例如 22,8000 或者 8000-8010。 这个参数不能与 --local-port 或者 --remote-port 参数一起使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--exclude-ip string       排除受影响的 IP，支持通过子网掩码来指定一个网段的 IP 地址, 例如 192.168.1.0/24. 则 192.168.1.0~192.168.1.255 都生效。你也可以指定固定的 IP，如 192.168.1.1 或者 192.168.1.1/32，也可以通过都号分隔多个参数，例如 192.168.1.1,192.168.2.1。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--interface string        网卡设备，例如 eth0 (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--local-port string       本地端口，一般是本机暴露服务的端口。可以指定多个，使用逗号分隔或者连接符表示范围，例如 80,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--offset string           延迟时间上下浮动的值, 单位是毫秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--remote-port string      远程端口，一般是要访问的外部暴露服务的端口。可以指定多个，使用逗号分隔或者连接符表示范围，例如 80,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--time string             延迟时间，单位是毫秒 (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--force                   强制覆盖已有的 tc 规则，请务必在明确之前的规则可覆盖的情况下使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--ignore-peer-port        针对添加 --exclude-port 参数，报 ss 命令找不到的情况下使用，忽略排除端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string          设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 访问本机 8080 和 8081 端口延迟 3 秒，延迟时间上下浮动 1 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network delay --time 3000 --offset 1000 --interface eth0 --local-port 8080,8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可以在另一台相同网络内的机器通过 telnet 命令验证，即 telnet xxx.xxx.xxx.xxx 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 销毁实验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade destroy 9b4aa9fabe073624</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 本机访问外部 14.215.177.39 机器（ping www.baidu.com 获取到的 IP）80 端口延迟 3 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network delay --time 3000 --interface eth0 --remote-port 80 --destination-ip 14.215.177.39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可在本机通过 telnet 14.215.177.39 80 命令验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 对整个网卡 eth0 做 5 秒延迟，排除 22 和 8000到8080 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network delay --time 5000 --interface eth0 --exclude-port 22,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 会发现 22 端口和 8000 到 8080 端口不受影响，可在另一台相同网络内的机器通过分别 telnet xxx.xxx.xxx.xxx 8080 和 telnet xxx.xxx.xxx.xxx 8081 进行测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network delay --time 3000 --offset 1000 --interface eth0 --local-port 3000 --timeout 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">telnet 127.0.0.1 3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-network-dns">blade create network dns<a href="#blade-create-network-dns" class="hash-link" aria-label="blade create network dns的直接链接" title="blade create network dns的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">篡改 dns 域名解析实验场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">此实验会修改本地的 hosts，篡改域名地址映射。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">网络丢包场景主要验证域名解析异常的情况下，系统的自我容错能力。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--domain string    域名 (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--ip string        映射的 ip (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string   设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># www.baidu.com 域名不可访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network dns --domain www.baidu.com --ip 10.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 ping www.baidu.com 来验证，会发现访问不通。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network dns --domain www.baidu.com --ip 10.0.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-network-loss">blade create network loss<a href="#blade-create-network-loss" class="hash-link" aria-label="blade create network loss的直接链接" title="blade create network loss的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">网络丢包实验场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">可以指定网卡、本地端口、远程端口、目标 IP 丢包。需要特别注意，如果不指定端口、ip 参数，而是整个网卡丢包，切记要添加 --timeout 参数或者 --exclude-port 参数，前者是指定运行时间，自动停止销毁实验，后者是指定排除掉的丢包端口，两者都是防止因丢包率设置太高，造成机器无法连接的情况，如果真实发生此问题，重启机器即可恢复。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">本地端口和远程端口之间是或的关系，即这两个端口都会发生丢包，只要指定了本地端口或者远程端口，无需指定需要排除的端口。端口与 IP 之间是与的关系，即指定的 IP:PORT 发生丢包。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">网络丢包场景主要验证网络异常的情况下，系统的自我容错能力。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--destination-ip string   目标 IP. 支持通过子网掩码来指定一个网段的 IP 地址, 例如 192.168.1.0/24. 则 192.168.1.0~192.168.1.255 都生效。你也可以指定固定的 IP，如 192.168.1.1 或者 192.168.1.1/32，也可以通过都号分隔多个参数，例如 192.168.1.1,192.168.2.1。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--exclude-port string     排除掉的端口，默认会忽略掉通信的对端端口，目的是保留通信可用。可以指定多个，使用逗号分隔或者连接符表示范围，例如 22,8000 或者 8000-8010。 这个参数不能与 --local-port 或者 --remote-port 参数一起使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--exclude-ip string       排除受影响的 IP，支持通过子网掩码来指定一个网段的 IP 地址, 例如 192.168.1.0/24. 则 192.168.1.0~192.168.1.255 都生效。你也可以指定固定的 IP，如 192.168.1.1 或者 192.168.1.1/32，也可以通过都号分隔多个参数，例如 192.168.1.1,192.168.2.1。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--interface string        网卡设备，例如 eth0 (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--local-port string       本地端口，一般是本机暴露服务的端口。可以指定多个，使用逗号分隔或者连接符表示范围，例如 80,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--percent string          丢包百分比，取值在[0, 100]的正整数 (必要参数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--remote-port string      远程端口，一般是要访问的外部暴露服务的端口。可以指定多个，使用逗号分隔或者连接符表示范围，例如 80,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--force                   强制覆盖已有的 tc 规则，请务必在明确之前的规则可覆盖的情况下使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--ignore-peer-port        针对添加 --exclude-port 参数，报 ss 命令找不到的情况下使用，忽略排除端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout string          设定运行时长，单位是秒，通用参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 访问本机 8080 和 8081 端口丢包率 70%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network loss --percent 70 --interface eth0 --local-port 8080,8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 本机访问外部 14.215.177.39 机器（ping www.baidu.com 获取到的 IP）80 端口丢包率 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network loss --percent 100 --interface eth0 --remote-port 80 --destination-ip 14.215.177.39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 可在本机通过 curl 14.215.177.39 命令验证，会发现访问不通。执行 curl 14.215.177.38 是通的。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 对整个网卡 eth0 做 60% 的丢包，排除 22 和 8000到8080 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network loss --percent 60 --interface eth0 --exclude-port 22,8000-8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 会发现 22 端口和 8000 到 8080 端口不受影响，可在另一台相同网络内的机器通过分别执行多次 curl xxx.xxx.xxx.xxx:8080 和 telnet xxx.xxx.xxx.xxx:8081 进行测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 实现整个网卡不可访问，不可访问时间 20 秒。执行完成下面命令后，当前的网络会中断掉，20 秒后恢复。切记！！勿忘 --timeout 参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network loss --percent 100 --interface eth0 --timeout 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create network loss --percent 70 --interface eth0 --local-port 3000 --timeout 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl 127.0.0.1:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ping 127.0.0.1:3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-docker">blade create docker<a href="#blade-create-docker" class="hash-link" aria-label="blade create docker的直接链接" title="blade create docker的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nginx-test -p 80:80 -d nginx:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看容器 id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker ps |grep nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看容器 cpu men 情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker ps -q | xargs  docker stats --no-stream</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-docker-cpu">blade create docker cpu<a href="#blade-create-docker-cpu" class="hash-link" aria-label="blade create docker cpu的直接链接" title="blade create docker cpu的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">容器内 CPU 负载实验场景，同基础资源的 CPU 场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">支持 CPU 场景命令如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker cpu load 容器内 CPU 负载场景，同 [blade create cpu load](blade create cpu load.md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">除了上述基础场景各自所需的参数外，在 docker 环境下，还支持的参数如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--blade-override           是否覆盖容器内已有的 chaosblade 工具，默认是 false，表示不覆盖，chaosblade 在容器内的部署路径为 /opt/chaosblade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--blade-tar-file string    指定本地 chaosblade-VERSION.tar.gz 工具包全路径，用于拷贝到容器内执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--container-id string      目标容器 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-endpoint string   Docker server 地址，默认为本地的 /var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对 container id 是 5239e26f6329 的做 CPU 使用率 80% 的实验场景，执行命令如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker cpu fullload --cpu-percent 80 --blade-tar-file /root/chaosblade-0.4.0.tar.gz --container-id 5239e26f6329 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践（未实践成功）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker cpu fullload --cpu-percent 80 --blade-tar-file /root/chaosblade/chaosblade-1.7.1-linux-amd64.tar.gz container-id 50811970d1f4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-docker-network">blade create docker network<a href="#blade-create-docker-network" class="hash-link" aria-label="blade create docker network的直接链接" title="blade create docker network的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">介绍</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">容器内网络实验场景，同基础资源的网络场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">支持的网络场景命令如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker network delay 容器网络延迟，同 [blade create network delay](blade create network delay.md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker network loss 容器网络丢包，同 [blade create network loss](blade create network loss.md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker network dns 容器内域名访问异常，同 [blade create network dns](blade create network dns.md)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">除了上述基础场景各自所需的参数外，在 docker 环境下，还支持的参数如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--container-id string      目标容器 ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-endpoint string   Docker server 地址，默认为本地的 /var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--image-repo string        chaosblade-tool 镜像仓库地址，默认是从 `registry.cn-hangzhou.aliyuncs.com/chaosblade`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">案例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对 nginx 容器 80 端口做访问延迟 3 秒，执行命令如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker network delay --time 3000 --interface eth0 --local-port 80 --container-id 5239e26f6329</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">实践（未实践成功）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create docker network delay --time 3000 --interface eth0 --local-port 80 --container-id 50811970d1f4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-k8s">blade create k8s<a href="#blade-create-k8s" class="hash-link" aria-label="blade create k8s的直接链接" title="blade create k8s的直接链接">​</a></h4><p><strong>k8s 实验场景</strong></p><p><a href="https://github.com/chaosblade-io/chaosblade-operator/tree/master/examples" target="_blank" rel="noopener noreferrer">chaosblade-operator yml 示例</a></p><ul><li><p>blade create k8s node-cpu Node 节点 CPU 负载场景</p></li><li><p>blade create k8s node-network Node 节点网络场景</p></li><li><p>blade create k8s node-process Node 节点进程场景</p></li><li><p>blade create k8s node-disk Node 节点磁盘场景</p></li><li><p>blade create k8s pod-pod Pod 资源场景，比如杀 Pod</p></li><li><p>blade create k8s pod-network Pod 网络资源场景，比如网络延迟</p></li><li><p>blade create k8s pod-IO Pod IO 文件系统异常场景</p></li><li><p>blade create k8s pod-fail Pod 不可用异常场景</p></li><li><p>blade create k8s container-container Container 资源场景，比如杀容器</p></li><li><p>blade create k8s container-cpu 容器内 CPU 负载场景</p></li><li><p>blade create k8s container-network 容器内网络场景</p></li><li><p>blade create k8s container-process 容器内进程场景</p></li></ul><p><strong>k8s 相关操作</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">查看 node 占有资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod 的容器名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod mysql -n my-space -o jsonpath={.spec.containers[*].name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod 占用资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pod -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod 标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -A --show-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pods -A | sort --reverse --key 3 --numeric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看 pod memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pods -A | sort --reverse --key 4 --numeric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">踩坑：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1、node-cpu 时候使用--names 提示参数非法（bug，待官方人员修复），可用--labels 替代</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-cpu load --names k8s-master --cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-cpu load --labels kubernetes.io/hostname=k8s-master --cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、~/.kube/config 的ip 地址得改成内网的，不然使用 k8s 故障的时候会报错地址无效；注意填写正确的内网地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-k8s-node-cpu">blade create k8s node-cpu<a href="#blade-create-k8s-node-cpu" class="hash-link" aria-label="blade create k8s node-cpu的直接链接" title="blade create k8s node-cpu的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node 节点 CPU 负载场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-cpu load --names &lt;nodeName&gt; --cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-cpu load --names k8s-master --cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top node / top</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-k8s-node-disk">blade create k8s node-disk<a href="#blade-create-k8s-node-disk" class="hash-link" aria-label="blade create k8s node-disk的直接链接" title="blade create k8s node-disk的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node 节点磁盘场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-disk fill --names &lt;nodeName&gt; --path /home --percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-disk fill --names k8s-master --path /home --percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h /home</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-k8s-node-mem">blade create k8s node-mem<a href="#blade-create-k8s-node-mem" class="hash-link" aria-label="blade create k8s node-mem的直接链接" title="blade create k8s node-mem的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Node 节点内存场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-mem load --names &lt;nodeName&gt; --mem-percent 80 --mode=ram --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-mem load --names k8s-master --mem-percent 80 --mode=ram --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top node / top</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blade-create-k8s-node-network">blade create k8s node-network<a href="#blade-create-k8s-node-network" class="hash-link" aria-label="blade create k8s node-network的直接链接" title="blade create k8s node-network的直接链接">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network Node 节点网络场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network delay 节点网络延迟场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network loss 节点网络丢包场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network dns 节点域名访问异常场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network delay --names &lt;nodeName&gt; --interface eth0 --time 3000 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s node-network delay --names k8s-master --interface eth0 --time 3000 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查：？</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>pod 故障演练</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s pod-network Pod 网络资源场景，比如网络延迟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s pod-network delay Pod 网络延迟场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s pod-network loss Pod 网络丢包场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s pod-network dns Pod 域名访问异常场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s pod-network delay --time 3000 --offset 1000 --interface eth0 --local-port 6379 --names redis-slave-674d68586-jnf7f --namespace default --kubeconfig config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>container 故障演练</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s container-cpu 容器内 CPU 负载场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s container-cpu fullload --names &lt;pod 名称&gt; --namespace &lt;ns 名称&gt; --container-names &lt;容器名称&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例1：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s container-cpu fullload --names redis --namespace my-space --container-names redis \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举例2（未实践成功）：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod mysql-mysql-master-0 -n my-space -o jsonpath={.spec.containers[*].name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blade create k8s container-cpu fullload --names mysql-mysql-master-0 --namespace my-space --container-names mysql \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cpu-percent 80 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">检查：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pod -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">根据消耗的 cpu 排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pod -A | sort --reverse --key 3 --numeric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">根据消耗的 men 排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pod -A | sort --reverse --key 4 --numeric</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-chaosblade-原理">4. ChaosBlade 原理<a href="#4-chaosblade-原理" class="hash-link" aria-label="4. ChaosBlade 原理的直接链接" title="4. ChaosBlade 原理的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-磁盘-io">4.1 磁盘 IO<a href="#41-磁盘-io" class="hash-link" aria-label="4.1 磁盘 IO的直接链接" title="4.1 磁盘 IO的直接链接">​</a></h3><p><code>dd</code>是一个用于数据转换和复制的命令行工具，它在Linux和其他类Unix系统中广泛使用。它的名称&quot;dd&quot;代表&quot;数据复制&quot;（data duplicator）</p><p>dd 命令的基本用法和一些常见的选项：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=input_file of=output_file bs=block_size count=num_blocks [options]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>if</code>（input file）：指定输入文件或数据源。</li><li><code>of</code>（output file）：指定输出文件或数据目标。</li><li><code>bs</code>（block size）：指定每次复制的数据块大小。默认单位是字节。</li><li><code>count</code>：指定要复制的数据块数量。</li></ul><p>常见的选项包括：</p><ul><li><p><code>iflag</code>：用于指定输入选项</p></li><li><ul><li><code>direct</code>：执行直接 IO，绕过文件系统缓存。</li><li><code>dsync</code>：在每次读取后进行 <code>fsync</code>，确保数据写入磁盘。</li><li><code>fullblock</code>：读取操作将始终读取完整的块，而不会读取部分块。</li><li><code>nonblock</code>：使用非阻塞 IO。</li><li><code>noatime</code>：不更新文件的访问时间。</li></ul></li><li><p><code>oflag</code>：用于指定输出选项</p></li><li><ul><li><code>direct</code>：执行直接 IO，绕过文件系统缓存。</li><li><code>dsync</code>：在每次写入后进行 <code>fsync</code>，确保数据写入磁盘。</li><li><code>fullblock</code>：写入操作将始终写入完整的块，而不会写入部分块。</li><li><code>nonblock</code>：使用非阻塞 IO。</li><li><code>nocreat</code>：如果输出文件不存在，则不创建该文件。</li><li><code>excl</code>：当创建输出文件时，如果文件已存在，则返回错误。</li></ul></li><li><p><code>status</code>：控制进度信息的显示频率。</p></li><li><p><code>seek</code>：指定输出文件的起始偏移量。</p></li><li><p><code>skip</code>：跳过输入文件的起始偏移量。</p></li></ul><p>以下是一些 <code>dd</code> 命令的示例：</p><p>从一个文件复制到另一个文件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=input.txt of=output.txt bs=1024</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建一个固定大小的空文件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=/dev/zero of=emptyfile bs=1M count=100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将一个硬盘分区备份到一个文件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=/dev/sdb1 of=backup.img bs=4M</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从一个设备读取数据并写入另一个设备：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=/dev/sda of=/dev/sdb bs=4096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生成随机数据并写入文件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dd if=/dev/urandom of=randomdata.bin bs=1M count=10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-知识碎片">5. 知识碎片<a href="#5-知识碎片" class="hash-link" aria-label="5. 知识碎片的直接链接" title="5. 知识碎片的直接链接">​</a></h2><p><a href="https://wi9wku2j1p.feishu.cn/sheets/H5HEsuWGohJZsKtLTQscMVY4n8c" target="_blank" rel="noopener noreferrer">高可用测试用例</a></p><p><strong>踩坑</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">执行：blade create k8s node-network delay --labels kubernetes.io/hostname=k8s-master --interface eth0 --time 3000 --timeout 60 --kubeconfig ~/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">报错：{&quot;code&quot;:54000,&quot;success&quot;:false,&quot;error&quot;:&quot;`/bin/sh -c tc qdisc add dev eth0 root netem delay 3000ms 0ms`: cmd exec failed, err: RTNETLINK answers: No such file or directory\n exit status 2&quot;,&quot;result&quot;:{&quot;uid&quot;:&quot;71abedb31cae2694&quot;,&quot;success&quot;:false,&quot;error&quot;:&quot;`/bin/sh -c tc qdisc add dev eth0 root netem delay 3000ms 0ms`: cmd exec failed, err: RTNETLINK answers: No such file or directory\n exit status 2&quot;,&quot;statuses&quot;:[{&quot;state&quot;:&quot;Error&quot;,&quot;error&quot;:&quot;`/bin/sh -c tc qdisc add dev eth0 root netem delay 3000ms 0ms`: cmd exec failed, err: RTNETLINK answers: No such file or directory\n exit status 2&quot;,&quot;success&quot;:false,&quot;kind&quot;:&quot;node&quot;,&quot;identifier&quot;:&quot;/k8s-master/&quot;}]}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">解决：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install iproute-tc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install kernel-modules-extra</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CSBasic/Windows"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Chaos/ChaosMesh"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">ChaosMesh</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-chaosblade-入门" class="table-of-contents__link toc-highlight">1. ChaosBlade 入门</a><ul><li><a href="#11-chaosblade-简介" class="table-of-contents__link toc-highlight">1.1 ChaosBlade 简介</a></li><li><a href="#12-chaosblade-架构" class="table-of-contents__link toc-highlight">1.2 ChaosBlade 架构</a></li></ul></li><li><a href="#2-chaosblade-搭建" class="table-of-contents__link toc-highlight">2. ChaosBlade 搭建</a><ul><li><a href="#21-chaosblade-搭建" class="table-of-contents__link toc-highlight">2.1 ChaosBlade 搭建</a></li><li><a href="#22-chaosblade-operator-搭建" class="table-of-contents__link toc-highlight">2.2 ChaosBlade Operator 搭建</a></li><li><a href="#23-chaosblade-box-搭建" class="table-of-contents__link toc-highlight">2.3 ChaosBlade Box 搭建</a></li></ul></li><li><a href="#3-chaosblade-实验" class="table-of-contents__link toc-highlight">3. ChaosBlade 实验</a><ul><li><a href="#31-chaosblade-场景" class="table-of-contents__link toc-highlight">3.1 ChaosBlade 场景</a></li><li><a href="#32-chaosblade-基础" class="table-of-contents__link toc-highlight">3.2 ChaosBlade 基础</a></li><li><a href="#32-chaosblade-实验" class="table-of-contents__link toc-highlight">3.2 ChaosBlade 实验</a></li></ul></li><li><a href="#4-chaosblade-原理" class="table-of-contents__link toc-highlight">4. ChaosBlade 原理</a><ul><li><a href="#41-磁盘-io" class="table-of-contents__link toc-highlight">4.1 磁盘 IO</a></li></ul></li><li><a href="#5-知识碎片" class="table-of-contents__link toc-highlight">5. 知识碎片</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cbea1bda.js"></script>
<script src="/assets/js/main.904b21c1.js"></script>
</body>
</html>