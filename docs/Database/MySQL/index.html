<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Database/MySQL/MySQL">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">MySQL | 知行合一</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://iewiewiew.github.io/img/me.jpeg"><meta data-rh="true" name="twitter:image" content="https://iewiewiew.github.io/img/me.jpeg"><meta data-rh="true" property="og:url" content="https://iewiewiew.github.io/docs/Database/MySQL/"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MySQL | 知行合一"><meta data-rh="true" name="description" content="[TOC]"><meta data-rh="true" property="og:description" content="[TOC]"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://iewiewiew.github.io/docs/Database/MySQL/"><link data-rh="true" rel="alternate" href="https://iewiewiew.github.io/docs/Database/MySQL/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://iewiewiew.github.io/docs/Database/MySQL/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZNU4NQPM1V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="知行合一" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0ebb5d40.css">
<link rel="preload" href="/assets/js/runtime~main.cbea1bda.js" as="script">
<link rel="preload" href="/assets/js/main.904b21c1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/me.jpeg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/me.jpeg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">wei</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">目录</a><a href="https://www.processon.com/mindmap/6138112f1e085306ef9fe608" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">技能图谱<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/iewiewiew" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">README</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/AI/">AI</a><button aria-label="打开/收起侧边栏菜单「AI」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/CSBasic/Network">CSBasic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Chaos/ChaosBlade">Chaos</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Database/ClickHouse/">Database</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/ClickHouse/">ClickHouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/Elasticsearch">Elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/GraphQL/">GraphQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/InfluxDB/">InfluxDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Database/MySQL/">MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/PostgreSQL/">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/Redis">Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/SQLite">SQLite</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Database/向量数据库">向量数据库</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/DevOps/">DevOps</a><button aria-label="打开/收起侧边栏菜单「DevOps」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Git/">Git</a><button aria-label="打开/收起侧边栏菜单「Git」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/Linux/">Linux</a><button aria-label="打开/收起侧边栏菜单「Linux」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Middleware/Apollo/">Middleware</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Mixinfo/BigData/大数据">Mixinfo</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/SoftwareTest/AppTest">SoftwareTest</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Database</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MySQL</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>MySQL</h1></header><p>[TOC]</p><h1 align="center">MySQL</h1><blockquote><p>By：weimenghua<br>
<!-- -->Date：2023.03.21<br>
<!-- -->Descrition：MySQL 关系型数据库</p></blockquote><p><a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener noreferrer">MySQL 下载</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-数据库基础">1. 数据库基础<a href="#1-数据库基础" class="hash-link" aria-label="1. 数据库基础的直接链接" title="1. 数据库基础的直接链接">​</a></h2><p>数据库连接</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// mysql 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.url=jdbc:mysql://127.0.0.1:3306/demo?characterEncoding=UTF-8&amp;amp;autoReconnect=true&amp;amp;failOverReadOnly=false&amp;amp;zeroDateTimeBehavior=convertToNull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.driverClass=com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.user=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.password=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// hive 驱动(下载地址：https://github.com/timveil/hive-jdbc-uber-jar/releases/download/v1.9-2.6.5/hive-jdbc-uber-2.6.5.0-292.jar)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.url=jdbc:hive2://{host}[:{port}][/{database}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.driverClass=org.apache.hive.jdbc.HiveDriver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.user=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jdbc.password=root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重置 MySQL 密码</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/mysql/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mysqld_safe --skip-grant-tables </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use mysql</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update user </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> where </span><span class="token assign-left variable" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush privileges</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /usr/local/mysql/support-files/mysql.server restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/mysql/bin/mysql -uroot -proot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>count(1) and count(字段)的区别</p><p>1、count(1) 会统计表中的所有的记录数，包含字段为 null 的记录。<br>
<!-- -->2、count(字段) 会统计该字段在表中出现的次数，忽略字段为 null 的情况。即不统计字段为 null 的记录。<br>
<!-- -->在 InnoDB 中 COUNT(*)和 COUNT(1)实现上没有区别，而且效率一样。</p><p>drop、truncate 和 delete 的区别</p><ol><li><p>drop<br>
<!-- -->1、drop 是 DDL，会隐式提交，所以，不能回滚，不会触发触发器。<br>
<!-- -->2、drop 语句删除表结构及所有数据，并将表所占用的空间全部释放。<br>
<!-- -->3、drop 语句将删除表的结构所依赖的约束，触发器，索引，依赖于该表的存储过程/函数将保留,但是变为 invalid 状态。</p></li><li><p>delete<br>
<!-- -->1、delete 是 DML，执行 delete 操作时，每次从表中删除一行，并且同时将该行的的删除操作记录在 redo 和 undo 表空间中以便进行回滚（rollback）和重做操作，但要注意表空间要足够大，需要手动提交（commit）操作才能生效，可以通过 rollback 撤消操作。<br>
<!-- -->2、delete 可根据条件删除表中满足条件的数据，如果不指定 where 子句，那么删除表中所有记录。<br>
<!-- -->3、delete 语句不影响表所占用的 extent，高水线(high watermark)保持原位置不变。</p></li><li><p>truncate<br>
<!-- -->1、truncate 是 DDL，会隐式提交，所以，不能回滚，不会触发触发器。<br>
<!-- -->2、truncate 会删除表中所有记录，并且将重新设置高水线和所有的索引，缺省情况下将空间释放到 minextents 个 extent，除非使用 reuse storage，。不会记录日志，所以执行速度很快，但不能通过 rollback 撤消操作（如果一不小心把一个表 truncate 掉，也是可以恢复的，只是不能通过 rollback 来恢复）。<br>
<!-- -->3、对于外键（foreignkey ）约束引用的表，不能使用 truncate table，而应使用不带 where 子句的 delete 语句。<br>
<!-- -->4、truncate table 不能用于参与了索引视图的表。</p></li><li><p>总结<br>
<!-- -->1、在速度上，一般来说，drop&gt; truncate &gt; delete。<br>
<!-- -->2、在使用 drop 和 truncate 时一定要注意，虽然可以恢复，但为了减少麻烦，还是要慎重。<br>
<!-- -->3、如果想删除部分数据用 delete，注意带上 where 子句，回滚段要足够大；<br>
<!-- -->如果想删除表，当然用 drop；<br>
<!-- -->如果想保留表而将所有数据删除，如果和事务无关，用 truncate 即可；<br>
<!-- -->如果和事务有关，或者想触发 trigger，还是用 delete；<br>
<!-- -->如果是整理表内部的碎片，可以用 truncate 跟上 reuse stroage，再重新导入/插入数据。</p></li></ol><p>隐式提交</p><p>隐式提交（Implicit Commit）：在MySQL中，事务是用来确保一系列数据库操作的原子性、一致性、隔离性和持久性的机制。当开启事务后，通常需要显式地调用提交操作（COMMIT）来将事务的更改保存到数据库中。然而，在某些情况下，MySQL会自动执行隐式提交，即在不显式调用提交操作的情况下自动将事务的更改提交到数据库。例如，当使用自动提交模式（autocommit mode）时，每个SQL语句都会被视为一个单独的事务，并自动进行提交。</p><p>隐式排序</p><p>隐式排序（Implicit Ordering）：在MySQL中，查询结果的排序可以通过使用ORDER BY子句来显式指定。然而，如果查询没有指定ORDER BY子句，MySQL并不会保证结果集的特定顺序。这意味着数据库引擎可以以任意顺序返回结果，通常是按照数据在存储中的物理顺序或索引顺序返回。这种没有明确指定排序顺序的查询结果集被称为隐式排序。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-sql-执行详解">2. sql 执行详解<a href="#2-sql-执行详解" class="hash-link" aria-label="2. sql 执行详解的直接链接" title="2. sql 执行详解的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-执行过程">sql 执行过程<a href="#sql-执行过程" class="hash-link" aria-label="sql 执行过程的直接链接" title="sql 执行过程的直接链接">​</a></h3><p>Step1：客户端向 Mysql 服务器发送 SQL 语句。<br>
<!-- -->Step2：服务器收到后先查询”查询缓存“，如果命中，从缓存中直接返回 sql 执行的结果集。否则，进入 Step3。<br>
<!-- -->Step3：服务器解析、预处理、优化 sql 执行计划，然后将处理好的 sql 放入查询的执行计划中。<br>
<!-- -->Step4：执行引擎通过调用”存储引擎”(如，innodb、myisam 等)提供的 API 去执行这个计划。<br>
<!-- -->Step5：服务器返回结果给客户端。  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-执行顺序">sql 执行顺序<a href="#sql-执行顺序" class="hash-link" aria-label="sql 执行顺序的直接链接" title="sql 执行顺序的直接链接">​</a></h3><p>优化动作越靠前越好</p><ol><li>from</li><li>on</li><li>join</li><li>where</li><li>group by</li><li>avg\sum...</li><li>having</li><li>select</li><li>distinct</li><li>order by</li><li>limit</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-编写顺序">sql 编写顺序<a href="#sql-编写顺序" class="hash-link" aria-label="sql 编写顺序的直接链接" title="sql 编写顺序的直接链接">​</a></h3><p>编写顺序: select distinct from join on where group by having order by limit</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT DISTINCT &lt; select_list &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM &lt; left_table &gt; &lt; join_type &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JOIN &lt; right_table &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ON &lt; join_condition &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE &lt; where_condition &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY &lt; group_by_list &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HAVING &lt; having_condition &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY &lt; order_by_condition &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LIMIT &lt; limit_number &gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-解析顺序">sql 解析顺序<a href="#sql-解析顺序" class="hash-link" aria-label="sql 解析顺序的直接链接" title="sql 解析顺序的直接链接">​</a></h3><p>解析顺序: from on join where group by having select distinct order by limit</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM &lt;left_table&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ON &lt;join_condition&gt; &lt;join_type&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JOIN &lt;right_table&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE &lt;where_condition&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY &lt;group_by_list&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HAVING &lt;having_condition&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISTINCT &lt;select_list&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY &lt;order_by_condition&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LIMIT &lt;limit_number&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-执行关键字解释">sql 执行关键字解释<a href="#sql-执行关键字解释" class="hash-link" aria-label="sql 执行关键字解释的直接链接" title="sql 执行关键字解释的直接链接">​</a></h3><ol><li>Distinct(去重)：用于返回唯一不同的值</li><li>where 子句用于提取那些满足指定条件的记录</li><li>AND：如果第一个条件和第二个条件都成立，则 AND 运算符显示一条记录</li><li>OR：如果第一条和第二个条件中只要有一个条件成立，则 OR 运算符显示一条记录</li><li>ORDER BY：用于对结果集按照一个列过分多个列进行排序，默认升序，可以使用 DESC 改为降序(desc 只对紧跟着的第一个列名有效，其他不受影响)</li><li>LIMIT：选取指定的条数数据，分页查询</li><li>LIKE：用于在 where 子句中搜索列中的指定模式，也可以匹配字符串</li><li>IN：允许在 where 子句中规定多个值</li><li>BETWEEN 用于选取介于两个值之间的数据范围内的值</li><li>JOIN：用来将两个或者多个表的行连接起来，基于这些表之间的共同字段</li><li>UNION：合并两个或者多个 select 语句的结果,如果允许重复的值使用 UNION ALL</li><li>SELECT INTO：从一个表复制数据，然后将数据插入到另一个新表中</li><li>子查询：出现在其他语句内部的 select 语句，称为子查询或者内查询，内部嵌套其他 select 语句的查询，称为外查询或主查，子查询的执行优先于主查询的执行，主查询的条件用到了子查询的结果</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-执行计划-explain">sql 执行计划 explain<a href="#sql-执行计划-explain" class="hash-link" aria-label="sql 执行计划 explain的直接链接" title="sql 执行计划 explain的直接链接">​</a></h3><p>通过 explain 这个命令来查看一个这些 SQL 语句的执行计划。查看该 SQL 语句有没有使用上了索引，有没有做全表扫描，这都可以通过 explain 命令来查看。
<!-- -->![avater]<!-- -->(img/sql 执行计划 explain.png)</p><p>概要描述  </p><ol><li>id：选择标识符</li><li>select_type：表示查询的类型。</li><li>table：输出结果集的表</li><li>partitions：匹配的分区</li><li>type：表示表的连接类型</li><li>possible_keys：表示查询时，可能使用的索引</li><li>key：表示实际使用的索引</li><li>key_len：索引字段的长度</li><li>ref：列与索引的比较</li><li>rows：扫描出的行数(估算的行数)</li><li>filtered：按表条件过滤的行百分比</li><li>Extra：执行情况的描述和说明</li></ol><p>重点描述<br>
<!-- -->select_type：表示查询中每个 select 子句的类型</p><ul><li>SIMPLE(简单 SELECT，不使用 UNION 或子查询等)</li><li>PRIMARY(子查询中最外层查询，查询中若包含任何复杂的子部分，最外层的 select 被标记为 PRIMARY)</li><li>UNION(UNION 中的第二个或后面的 SELECT 语句)</li><li>DEPENDENT UNION(UNION 中的第二个或后面的 SELECT 语句，取决于外面的查询)</li><li>UNION RESULT(UNION 的结果，union 语句中第二个 select 开始后面所有 select)</li><li>SUBQUERY(子查询中的第一个 SELECT，结果不依赖于外部查询)</li><li>DEPENDENT SUBQUERY(子查询中的第一个 SELECT，依赖于外部查询)</li><li>DERIVED(派生表的 SELECT, FROM 子句的子查询)</li><li>UNCACHEABLE SUBQUERY(一个子查询的结果不能被缓存，必须重新评估外链接的第一行)</li></ul><p>type：对表访问方式，表示 MySQL 在表中找到所需行的方式，又称“访问类型”</p><ul><li>type=ALL，全表扫描，MySQL 遍历全表来找到匹配行</li><li>type=index，索引全扫描</li><li>type=range，索引范围扫描</li><li>type=eq_ref，唯一索引</li><li>type=NULL，MySQL 不用访问表或者索引，直接就能够得到结果（性能最好）</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-数据库索引">3. 数据库索引<a href="#3-数据库索引" class="hash-link" aria-label="3. 数据库索引的直接链接" title="3. 数据库索引的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引基数">索引基数<a href="#索引基数" class="hash-link" aria-label="索引基数的直接链接" title="索引基数的直接链接">​</a></h3><p>基数是数据列所包含的不同值的数量。<br>
<!-- -->例如，某个数据列包含值1、3、7、4、7、3，那么它的基数就是4。索引的基数相对于数据表行数较高（也就是说，列中包含很多不同的值，重复的值很少）的时候，它的工作效果最好。如果某数据列含有很多不同的年龄，索引会很快地分辨数据行。如果某个数据列用于记录性别（只有&quot;M&quot;和&quot;F&quot;两种值），那么索引的用处就不大。如果值出现的几率几乎相等，那么无论搜索哪个值都可能得到一半的数据行。在这些情况下，最好根本不要使用索引，因为查询优化器发现某个值出现在表的数据行中的百分比很高的时候，它一般会忽略索引，进行全表扫描。惯用的百分比界线是&quot;30%&quot;。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引的建立">索引的建立<a href="#索引的建立" class="hash-link" aria-label="索引的建立的直接链接" title="索引的建立的直接链接">​</a></h3><ol><li>根据业务经常查询的语句建立索引；</li><li>尽量选择区分度高的列作为索引，区分度的公式是 COUNT(DISTINCT col) / COUNT(*)，表示字段不重复的比率，比率越大扫描的记录数就越少；</li><li>如果业务中唯一特性最好建立唯一键，一方面可以保证数据的正确性，另一方面索引的效率能大大提高；</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引的分类">索引的分类<a href="#索引的分类" class="hash-link" aria-label="索引的分类的直接链接" title="索引的分类的直接链接">​</a></h3><p>索引分类：1、普通索引  2、唯一索引  3、主键索引  4、组合索引  5、联合索引</p><p>1、普通索引</p><p>创建索引：create index 索引的名字 on 表名(列名)   eg. create index empnoIndex on emp_copy(empno)<br>
<!-- -->删除索引：drop index 索引的名字 on 表名   eg. drop index empnoIndex on emp_copy<br>
<!-- -->查看索引：show index from 表名  eg. show index from emp_copy<br>
<!-- -->修改索引：
先删除 ALTER TABLE table_name DROP INDEX index_name
再以修改后的内容创建同名索引  CREATE INDEX index_name ON table_name</p><p>2、唯一索引</p><p>唯一索引有两个功能：加速查找和唯一约束（可含 null）
创建索引：create unique index 索引名 on 表名(列名)<br>
<!-- -->删除索引：drop index 索引的名字 on 表名  eg. drop index empnoIndex on emp_copy</p><p>3、主键索引</p><p>主键索引有两个功能：加速查找和唯一约束（不含 null）<br>
<!-- -->主键索引：alter table 表名 add primary key(列名);  eg.alter table emp_copy add primary key(deptno)<br>
<!-- -->删除主键索引：alter table 表名 drop primary key;   alter table 表名 modify 列名 int, drop primary key;</p><p>4、组合索引</p><p>组合索引是将 n 个列组合成一个索引,其应用场景为：频繁的同时使用 n 列来进行查询，如：where name = &#x27;alex&#x27; and email = &#x27;<a href="mailto:alex@qq.com" target="_blank" rel="noopener noreferrer">alex@qq.com</a>&#x27;。
create index 索引名 on 表名(列名1,列名2)   eg. create index enameIndex on emp_copy(ename,mgr)</p><p>5、联合索引</p><p>首先介绍一下联合索引（复合索引）。联合索引其实很简单，相对于一般索引只有一个字段，联合索引可以为多个字段创建一个索引。它的原理也很简单，比如，我们在（a,b,c）字段上创建一个联合索引，则索引记录会首先按照 A 字段排序，然后再按照 B 字段排序然后再是 C 字段，因此，联合索引的特点就是：<br>
<!-- -->第一个字段一定是有序的，当第一个字段值相等的时候，第二个字段又是有序的，比如下表中当 A=2时所有 B 的值是有序排列的，依次类推，当同一个 B 值得所有 C 字段是有序排列的；
其实联合索引的查找就跟查字典是一样的，先根据第一个字母查，然后再根据第二个字母查，或者只根据第一个字母查，但是不能跳过第一个字母从第二个字母开始查。这就是所谓的最左前缀原理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引的优缺点">索引的优缺点<a href="#索引的优缺点" class="hash-link" aria-label="索引的优缺点的直接链接" title="索引的优缺点的直接链接">​</a></h3><p>索引就是一个数据结构，我们把表中的记录用一个适合高效查找的数据结构来表示，目的就是让查询变得更高效。</p><p>1、优点</p><p>创建唯一性索引，保证数据库表中每一行数据的唯一性；
加速表和表之间的连接；</p><p>2、缺点</p><p>索引需要占物理空间；<br>
<!-- -->当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，降低了数据的维护速度；<br>
<!-- -->增加了插入和删除的操作时间，一个表拥有的索引越多，插入和删除的速度越慢。如要求快速录入的系统不宜建过多索引；</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引失效原因">索引失效原因<a href="#索引失效原因" class="hash-link" aria-label="索引失效原因的直接链接" title="索引失效原因的直接链接">​</a></h3><ol><li>对索引列运算，运算包括<code>（+、-、*、/. ！、&lt;&gt;、%、like&#x27;%_&#x27;（%放在前面）</code>；</li><li>类型错误，如字段类型为 varchar，where 条件用 number；</li><li>对索引应用内部函数，这种情况下应该建立基于函数的索引如 select * from template t where ROUND(t.logicdb_id) = 1此时应该建 ROUND(t.logicdb_id)为索引，mysql8.0开始支持函数索引，5.7可以通过虚拟列的方式来支持，之前只能新建一个 ROUND(t.logicdb_id)列然后去维护；</li><li>如果条件有 or，即使其中有条件带索引也不会使用（这也是为什么建议少使用 or 的原因），如果想使用 or，又想索引有效，只能将 or 条件中的每个列加上索引；</li><li>如果列类型是字符串，那一定要在条件中数据使用引号，否则不使用索引；</li><li>B-tree 索引 is null 不会走，is not null 会走，位图索引 is null，is not null 都会走；</li><li>组合索引遵循最左原则；</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引建立规则">索引建立规则<a href="#索引建立规则" class="hash-link" aria-label="索引建立规则的直接链接" title="索引建立规则的直接链接">​</a></h3><ol><li><p>表的主键. 外键必须有索引；</p></li><li><p>数据量超过300的表应该有索引；</p></li><li><p>经常与其他表进行连接的表，在连接字段上应该建立索引；</p></li><li><p>经常出现在 Where 子句中的字段，特别是大表的字段，应该建立索引；</p></li><li><p>索引应该建在选择性高的字段上；</p></li><li><p>索引应该建在小字段上，对于大的文本字段甚至超长字段，不要建索引；</p></li><li><p>复合索引的建立需要进行仔细分析；尽量考虑用单字段索引代替：
A、正确选择复合索引中的主列字段，一般是选择性较好的字段；<br>
<!-- -->B、复合索引的几个字段是否经常同时以 AND 方式出现在 Where 子句中？单字段查询是否极少甚至没有？如果是，则可以建立复合索引；否则考虑单字段索引；<br>
<!-- -->C、如果复合索引中包含的字段经常单独出现在 Where 子句中，则分解为多个单字段索引；<br>
<!-- -->D、如果既有单字段索引，又有这几个字段上的复合索引，一般可以删除复合索引；</p></li><li><p>频繁进行数据操作的表，不要建立太多的索引；</p></li><li><p>删除无用的索引，避免对执行计划造成负面影响；</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="知识碎片">知识碎片<a href="#知识碎片" class="hash-link" aria-label="知识碎片的直接链接" title="知识碎片的直接链接">​</a></h3><p>主键、外键和索引的区别</p><p>比如，A 表中的一个字段，是 B 表的主键，就可以是 A 表的外键。</p><table><thead><tr><th>主键</th><th>外键</th><th>索引</th></tr></thead><tbody><tr><td>唯一标识一条记录，不能有重复的，不允许为空</td><td>表的外键是另一表的主键, 外键可以有重复的, 可以是空值</td><td>该字段没有重复值，但可以有一个空值</td></tr><tr><td>用来保证数据完整性</td><td>用来和其他表建立联系用的</td><td>提高查询排序的速度</td></tr><tr><td>主键只能有一个</td><td>一个表可以有多个外键</td><td>一个表可以有多个唯一索引</td></tr></tbody></table><p>唯一约束和唯一索引的区别</p><p>约束 ：全称完整性约束，它是关系数据库中的对象，用来存放插入到一个表中一列数据的规则，用来确保数据的准确性和一致性。<br>
<!-- -->索引：数据库中用的最频繁的操作是数据查询，索引就是为了加速表中数据行的检索而创建的一种分散的数据结构。可以把索引类比成书的目录，有目录的肯定比没有目录的书，更方便查找。<br>
<!-- -->唯一约束：保证在一个字段或者一组字段里的数据都与表中其它行的对应数据不同。和主键约束不同，唯一约束允许为 NULL，只是只能有一行。<br>
<!-- -->唯一索引：不允许具有索引值相同的行，从而禁止重复的索引或键值。<br>
<!-- -->唯一约束和唯一索引都是为了保证表中被限制的字段不允许有重复的值，看起来功能是一样的，那为什么要设计这样两种一样的功能呢？<br>
<!-- -->唯一约束和唯一索引在 MySQL 数据库里区别了：
概念上不同，约束是为了保证数据的完整性，索引是为了辅助查询；创建唯一约束时，会自动的创建唯一索引；在理论上，不一样，在实际使用时，基本没有区别。<br>
<!-- -->关于第二条，MySQL 中唯一约束是通过唯一索引实现的，为了保证没有重复值，在插入新记录时会再检索一遍，怎样检索快，当然是建索引了，所以，在创建唯一约束的时候就创建了唯一索引。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-数据库日志">4. 数据库日志<a href="#4-数据库日志" class="hash-link" aria-label="4. 数据库日志的直接链接" title="4. 数据库日志的直接链接">​</a></h2><ul><li>重做日志（redo log）</li><li>二进制日志（bin log）</li><li>回滚日志（undo log）</li><li>错误日志（error log）</li><li>慢查询日志（slow query log）</li><li>一般查询日志（general log）</li><li>中继日志（relay log）</li></ul><p><a href="/docs/DevOps/Docker/Docker 安装软件.md">Docker 安装</a>，配置地址：<code>/var/lib/mysql</code>、<code>/etc/my.cnf</code>，此处已做目录挂载，可在宿主机修改配置后重启容器：<code>docker restart mysql</code>。</p><p>启用 binlog，编辑 MySQL 配置文件（通常是 /etc/my.cnf 或 /etc/mysql/my.cnf）, 在 <!-- -->[mysqld]<!-- --> 部分添加以下行：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">log-bin=binlog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>log-bin 指定 binlog 文件的基本名称，server-id 是唯一标识 MySQL 实例的数字</p><p>Mac 安装 mysql 客户端和 mysqlbinlog</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew install mysql-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysqlbinlog --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>连接 MySQL：<code>mysql -h127.0.0.1 -uroot -proot</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 执行 DDL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create database if not exists dbname;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看 binlog 文件列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHOW BINARY LOGS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看 binlog 文件内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHOW BINLOG EVENTS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看 binlog 相关信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHOW VARIABLES LIKE &#x27;log_bin%&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在客户端执行，输出 binlog 日志</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysqlbinlog --host=127.0.0.1 --port=3306 --user=root --password=root binlog.000001 &gt; .tmp/binlog1.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysqlbinlog --host=127.0.0.1 --port=3306 --user=root --password=root binlog.000002 &gt; .tmp/binlog2.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">踩坑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog.000003 及以后的日志无法输出，实际上是有的，可通过 scp 下载下来，再通过 cat 写入 txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r root@127.0.0.1:/var/lib/mysql/binlog.000003 binlog.000003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat binlog.000003 &gt; binlog3.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可在 binlog 日志中查看变更记录</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*!\C utf8mb4 *//*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET @@session.character_set_client=45,@@session.collation_connection=45,@@session.collation_server=255/*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET @@session.lc_time_names=0/*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET @@session.collation_database=DEFAULT/*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*!80011 SET @@session.default_collation_for_utf8mb4=255*//*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*!80016 SET @@session.default_table_encryption=0*//*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create database if not exists dbname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*!*/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># at 362</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在客户端执行，输出 binlog sql 记录</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysqlbinlog --host=127.0.0.1 --port=3306 --user=root --password=root --database=dbname binlog.000001 &gt; .tmp/events.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysqlbinlog --host=127.0.0.1 --port=3306 --user=root --password=root --start-datetime=&quot;2023-09-21 15:38:13&quot; --stop-datetime=&quot;2023-09-21 15:52:47&quot; --database=dbname binlog.000002 &gt; .tmp/events.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在客户端执行，恢复数据</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql --host=127.0.0.1 --port=3306 --user=root --password=root &lt; .tmp/events.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-数据库监控">5. 数据库监控<a href="#5-数据库监控" class="hash-link" aria-label="5. 数据库监控的直接链接" title="5. 数据库监控的直接链接">​</a></h2><p>1、如何监控数据库的连接数</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">数据库允许的最大连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;max_connections&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">数据库当前的连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show global status like &#x27;Threads_connected&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">判断是否需要报警</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Threads_connected / max_connections &gt; 0.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2、数据库可用性监控</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">列出MySQL服务器运行各种状态值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show global status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如何计算QPS和TPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QPS：每秒钟数据库所执行的查询的数量（包括了数据库所处理的所有请求）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QPS = (Queries2 - Queries1) / (Uptime_since_flush_status2 - Uptime_since_flush_status1)    # 两次采样的差值 / 两次采样的时间间隔</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TPS：每秒钟所处理的事物的数量，也就是每秒钟所处理的UPDATE、DELETE、INSERT这样的请求的数量。从定义上可以看出TPS实际上是OPS的一个子集。    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TPS = ((Com_insert2 + Com_update2 + Com_delete2) - (Com_insert1 + Com_update1 + Com_delete1)) / (Uptime_since_flush_status2 - Uptime_since_flush_status1) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>3、如何监控数据库的并发请求数量</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 并发请求数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show global status like &#x27;Threads_running&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>4、如何监控主从复制延迟</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">show master status \G;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show slave status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show slave status \G;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-知识碎片">6. 知识碎片<a href="#6-知识碎片" class="hash-link" aria-label="6. 知识碎片的直接链接" title="6. 知识碎片的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-vip-漂移">MySQL VIP 漂移<a href="#mysql-vip-漂移" class="hash-link" aria-label="MySQL VIP 漂移的直接链接" title="MySQL VIP 漂移的直接链接">​</a></h3><p>什么是 VIP 漂移</p><p>MySQL 三主部署，但在实际使用中，应用服务不能同时配置三个数据库源，通过 Keepalived 软件可以对外提供一个 VIP，当 VIP 所在服务丢失，VIP 可以漂移到其他正常服务器上并继续提供服务，对于用户此切换过程时间很短，几乎无感知。</p><p>VIP 漂移的两种方式</p><p>1、通过 keepalived 的方式
2、使用 MHA 自带的脚本</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-打满连接数">MySQL 打满连接数<a href="#mysql-打满连接数" class="hash-link" aria-label="MySQL 打满连接数的直接链接" title="MySQL 打满连接数的直接链接">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询最大连接数，默认的最大连接数都是151，上限为：100000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;%max_connections%&#x27;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;max_connections&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select @@max_connections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看实时连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show status like &#x27;Threads_connected&#x27;;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看服务器响应的最大连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show global status like &#x27;Max_used_connections&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 设置连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set global max_connections = 3; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看 mysql 文件路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;%datadir%&#x27;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- vim /etc/my.cnf，添加：max_connections=1，重启 MySQl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 通过 JMeter 建立 JDBC 连接，设置 10个 并发请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 第4个连接报错：Cannot create PoolableConnectionFactory (Data source rejected establishment of connection,  message from server: &quot;Too many connections&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Threads_connected： 连接数.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Threads_running： 激活的连接数，这个数值一般远低于 connected 数值.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Threads_connected：跟 show processlist 结果相同，表示当前连接数。准确的来说，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Threads_running：代表当前并发数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show status like &#x27;Threads%&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 查看 ibd 文件，文件路径：/var/lib/mysql/mysql，如果启动 docker 遇到文件冲突的错误，来此目录将冲突文件删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TABLESPACE_NAME,FILE_ID,FILE_NAME FROM INFORMATION_SCHEMA.FILES;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看-mysql-主节点">查看 MySQL 主节点<a href="#查看-mysql-主节点" class="hash-link" aria-label="查看 MySQL 主节点的直接链接" title="查看 MySQL 主节点的直接链接">​</a></h3><p>查看 MySQL 服务器上所有的从节点：<code>SHOW SLAVE HOSTS;</code>
如果是 Master 节点，展示 slave 节点信息</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Server_id | Host | Port | Master_id | Slave_UUID                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------+------+------+-----------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       696 |      | 3306 |       438 | 3a214c04-4ebc-11ed-9a25-xxxxx |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       214 |      | 3306 |       438 | 2446e2f9-4ebc-11ed-94d3-xxxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是 Slave 节点，返回：<code>Empty set (0.00 sec)</code></p><p>在 Master 节点执行：<code>SHOW MASTER STATUS;</code>
在 Slave 节点执行：<code>SHOW SLAVE STATUS\G;</code></p><p>查看日志文件路径：<code>SHOW VARIABLES LIKE &#x27;general_log_file&#x27;;</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="锁表">锁表<a href="#锁表" class="hash-link" aria-label="锁表的直接链接" title="锁表的直接链接">​</a></h3><p>迁移锁表</p><p>迁移锁表通常是指在数据库系统中进行数据迁移或者数据库迁移时，为了避免在迁移过程中产生数据不一致或丢失等问题，需要对表进行加锁，以保证迁移过程中的数据完整性。</p><p>在 MySQL 中，可以使用锁来保证并发访问数据库时数据的一致性。对于整张表的锁定，可以使用以下方式来锁定表：</p><ol><li>共享锁（Shared Lock）：该锁定方式被称为读锁，它允许多个事务同时读取同一张表，但是不允许任何事务对表进行写操作。可以使用以下语句来获取共享锁：</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LOCK TABLES table_name READ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>排它锁（Exclusive Lock）：该锁定方式被称为写锁，它只允许一个事务对表进行写操作，其他事务无法读取或写入该表。可以使用以下语句来获取排它锁：</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LOCK TABLES table_name WRITE;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>释放锁定</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">UNLOCK TABLES;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当前被锁定的表</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW OPEN TABLES WHERE In_use &gt; 0;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这条语句会显示当前所有被锁定的表和锁定方式。其中，In_use 表示该表当前被使用的连接数，如果该值大于0，表示该表被锁定了</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-系统变量">MySQL 系统变量<a href="#mysql-系统变量" class="hash-link" aria-label="MySQL 系统变量的直接链接" title="MySQL 系统变量的直接链接">​</a></h3><p>MySQL 的 <code>sql_mode</code> 是一个系统变量，用于控制 MySQL 数据库服务器的行为和执行结果。<code>sql_mode</code> 决定了 MySQL 是否执行严格模式、是否忽略非法日期和时间值、是否允许空值、是否区分大小写、是否允许自动转换数据类型等。</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">查看 sql_mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT @@sql_mode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">清空 sql_mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET sql_mode = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">在 MySQL 5.7 版本及以上，如果没有显式设置 sql_mode，则默认值为：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个默认值包含了以下几个参数：</p><ul><li><code>ONLY_FULL_GROUP_BY</code>：在使用 <code>GROUP BY</code> 时，要求所有的被选中的列都出现在 <code>GROUP BY</code> 子句中。</li><li><code>STRICT_TRANS_TABLES</code>：在插入、更新数据时，如果存在任何警告或错误，都会中止操作并回滚之前的操作。</li><li><code>NO_ZERO_IN_DATE</code>：禁止日期和时间值中出现 &#x27;0000-00-00&#x27; 的情况。</li><li><code>NO_ZERO_DATE</code>：禁止日期和时间值为 &#x27;0000-00-00&#x27;。</li><li><code>ERROR_FOR_DIVISION_BY_ZERO</code>：当除数为零时，抛出错误。</li><li><code>NO_ENGINE_SUBSTITUTION</code>：如果使用的存储引擎不可用，则不会使用其他存储引擎代替。</li></ul><p>大小写敏感</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">`demo` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT &#x27;示例&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>demo 列的 CHARACTER SET 和 COLLATE 分别指定为 utf8 和 utf8_bin，这意味着该列使用 utf8 字符集，排序规则为二进制排序（binary collation），并且是大小写敏感的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="本地链接-k8s-mysql">本地链接 K8S MySQL<a href="#本地链接-k8s-mysql" class="hash-link" aria-label="本地链接 K8S MySQL的直接链接" title="本地链接 K8S MySQL的直接链接">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --insecure-skip-tls-verify exec -it -n &lt;ns_name&gt; &lt;pod_name&gt; -- mysql -u&lt;username&gt; -p&lt;password&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-导出查询-sql">MySQL 导出查询 SQL<a href="#mysql-导出查询-sql" class="hash-link" aria-label="MySQL 导出查询 SQL的直接链接" title="MySQL 导出查询 SQL的直接链接">​</a></h3><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INTO OUTFILE &#x27;/path/to/output/file.sql&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM your_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE your_condition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * INTO OUTFILE &#x27;/Users/menghuawei/IdeaProjects/my-project/wei-notebook/.tmp/file.sql&#x27; from dbname.t_table_info;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>报错：1290 - The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</p><p>解决：</p><ol><li>使用 SELECT ... INTO OUTFILE 语句导出数据到 --secure-file-priv 所指定的目录之内。可以通过查看 MySQL 配置文件（如 my.cnf 或 my.ini）或在 MySQL 命令行中执行 SHOW VARIABLES LIKE &#x27;secure_file_priv&#x27;; 来确定该目录的位置。</li><li>将 --secure-file-priv 选项所指定的目录更改为允许导出文件的自定义目录。这需要修改 MySQL 的配置文件并重启 MySQL 服务器。可以将 --secure-file-priv 设置为一个可访问的目录路径，以便 MySQL 可以读取和写入文件。</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">which mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/homebrew/opt/mysql-client/bin/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -l /usr/local/ | grep mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/mysql/support-files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/mysql/my.cnf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>my.cnf</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secure_file_priv = /Users/menghuawei/IdeaProjects/my-project/wei-notebook/.tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_connections = 100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://github.com/dotnetcore/SmartCode" target="_blank" rel="noopener noreferrer">SmartCode</a></p><p><a href="https://archerydms.com/" target="_blank" rel="noopener noreferrer">Archery SQL 审核平台官网</a></p><p><a href="https://github.com/hhyo/Archery" target="_blank" rel="noopener noreferrer">Archery SQL 审核平台源码</a></p><p><a href="https://github.com/pressly/goose" target="_blank" rel="noopener noreferrer">Goose</a>，增量同步数据库结构的工具</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go install github.com/pressly/goose/v3/cmd/goose@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://raw.githubusercontent.com/pressly/goose/master/install.sh |sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install goose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose mysql &quot;user:password@/dbname?parseTime=true&quot; status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose create add_some_column sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose create fetch_user_data go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- +goose Up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE post (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id int NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title text,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">body text,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRIMARY KEY(id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- +goose Down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DROP TABLE post;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>字符集</p><ul><li>字符集（character set）：定义了字符以及字符的编码。</li><li>字符序（collation）：定义了字符的比较规则。</li></ul><p>有四个字符：A、B、a、b，这四个字符的编码分别是A = 0, B = 1, a = 2, b = 3。这里的字符 + 编码就构成了字符集（character set）。
比如A、B，或者a、b，最直观的比较方式是采用它们的编码，比如因为0 &lt; 1，所以 A &lt; B，这就是字符序。</p><p>MySQL在 5.5.3 之后增加了 utf8mb4 字符编码，mb4即 most bytes 4。简单说 utf8mb4 是 utf8 的超集并完全兼容utf8，能够用四个字节存储更多的字符。</p><p>emoji表情是1个字符占4个字节，而utf8编码只支持1-3个字节的字符，所以utf8编码下，如果直接存储表情，数据库存储会失败，所以需要改成utf8mb4。</p><p>MySQL有4个级别的字符集和比较规则，分别是：</p><ul><li>服务器级别：可以通过设置character_set_server和collation_server系统变量指定服务器字符集和排序规则；</li><li>数据库级别：给数据库指定字符集和排序规则；</li><li>表级别：可以指定表的字符集和排序规则；</li><li>列级别：同一个表中不同的列也可以有不同的字符集和排序规则。</li></ul><p><a href="https://drawdb.vercel.app/editor" target="_blank" rel="noopener noreferrer">图形化数据设计工具1</a><br>
<a href="https://dbdiagram.io/home" target="_blank" rel="noopener noreferrer">图形化数据设计工具2</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何定位慢-sql">如何定位慢 SQL<a href="#如何定位慢-sql" class="hash-link" aria-label="如何定位慢 SQL的直接链接" title="如何定位慢 SQL的直接链接">​</a></h3><p>查看是否开启慢查询
<code>show variables like &#x27;%slow%&#x27;;</code></p><p>结果</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Variable_name               Value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_slow_admin_statements OFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_slow_extra             OFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_slow_replica_statements OFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_slow_slave_statements OFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_launch_time         2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_query_log             OFF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_query_log_file         /usr/local/mysql/data/menghuadeMacBook-Pro-slow.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>sudo cp /usr/local/mysql/data/menghuadeMacBook-Pro-slow.log /Users/menghuawei/IdeaProjects/my-project/wei-notebook/Database/MySQL</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">系统变量log_slow_admin_statements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">表示是否将慢管理语句例如ANALYZE TABLE和ALTER TABLE等记入慢查询日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">启用log_slow_extra系统变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（从MySQL 8.0.14开始提供）将导致服务器将几个额外字段写入日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Log_slow_slave_statements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">从库默认是不写入慢查询的，开启之后从库慢查询日志写入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_query_log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这个参数设置为ON，可以捕获执行时间超过一定数值的SQL语句</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_query_log_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">记录日志的文件名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_launch_time=#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">表示如果建立线程花费了比这个值更长的时间，slow_launch_threads 计数器将增加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">开启慢查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set global slow_query_log=&#x27;ON&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">修改慢查询时间为5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set long_query_time = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show global status like &#x27;%slow%&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 显示哪些 SQL 线程正在运</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show full processlist;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/show full processlist-4f29203a166758a59870c1f8f32f681c.png" width="1380" height="143" class="img_ev3q"></p><p>字段说明</p><ul><li>ID：作为一个标识 ID，如果你打算 kill 一个 SQL，可以根据 ID 来进行。</li><li>User：当前正在执行 SQL 的用户，只显示你登录账号权限范围内能够看到的用户。</li><li>Host：显示这个语句是从哪个 ID 和端口上发出的。</li><li>db：当前线程使用的库名。</li><li>Command：连接执行的命令状态，一般是 Sleep、Query、Connect 等。</li><li>Time：状态持续的时间（单位是秒）。</li><li>State：显示当前 SQL 语句的状态，这是一个非常重要的判断标识，比如多次刷新命令时，发现 SQL 常处于 Sending data，那么这条 SQL 大概率是存在问题的。</li><li>Info：显示正在执行的 SQL 语句，这也是你能直接拿到慢 SQL 的方式。</li></ul><p>实例对比：索引对性能的影响</p><p>创建表</p><div class="language-mysql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mysql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create database if not exists dbname;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drop table if exists `t_table_info`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table `t_table_info`  (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` int(0) not null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `name` varchar(255) character set utf8mb4 collate utf8mb4_0900_ai_ci null default null comment &#x27;姓名（varchar(m) 存放长度不固定的字符）&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `age` int(0) null default null comment &#x27;年龄&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `sex` varchar(255) character set utf8mb4 collate utf8mb4_0900_ai_ci null default null comment &#x27;性别&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `job` varchar(255) character set utf8mb4 collate utf8mb4_0900_ai_ci null default null comment &#x27;职业&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `json_set` varchar(100) character set utf8mb4 collate utf8mb4_0900_ai_ci null default null comment &#x27;json 集合&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `text` text character set utf8mb4 collate utf8mb4_0900_ai_ci null comment &#x27;文本（text 存放长文本）&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `blob` blob null comment &#x27;不录歌（blob 存放较大的二进制，如图片等）&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `create_time` datetime(0) null default null comment &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `update_time` datetime(0) null default null on update current_timestamp(0) comment &#x27;更新时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  primary key (`id`) using btree,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unique index `index_id`(`id`) using btree,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index `index_name`(`name`) using btree,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index `index_age_sex`(`age`, `sex`) using btree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) engine = innodb character set = utf8mb4 collate = utf8mb4_0900_ai_ci row_format = dynamic;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>未加索引的前提下，使用 JMeter 根据 ID 进行查询</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">select * from `dbname`.t_table_info where id = &#x27;1&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果</p><p>添加索引的前提下，使用 JMeter 根据 ID 进行查询</p><p>测试结果</p><p>《八股文》MySQL面试夺命20问：<a href="https://mp.weixin.qq.com/s/I-n9bAIGWUAj1n2wP2OLjQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/I-n9bAIGWUAj1n2wP2OLjQ</a></p><p>连接数据库工具：<a href="https://github.com/dbgate/dbgate" target="_blank" rel="noopener noreferrer">https://github.com/dbgate/dbgate</a></p><p>MySQL 搭建
当前版本：<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/mysql/</a>
历史版本：<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener noreferrer">https://downloads.mysql.com/archives/community/</a></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 下载安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.20-linux-glibc2.12-x86_64.tar.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解压安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvf mysql-8.0.20-linux-glibc2.12-x86_64.tar.xz -C /usr/local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重命名目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/local/mysql-8.0.20-linux-glibc2.12-x86_64 /usr/local/mysql-8.0.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建存放数据文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /usr/local/mysql-8.0.20/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建用户及用户组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groupadd mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useradd -g mysql mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown -R mysql.mysql /usr/local/mysql-8.0.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置 my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /var/run/mysqld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown mysql:mysql /var/run/mysqld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown mysql:mysql /var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 初始化数据库(记录临时密码) !(rv?6Y0TQs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /usr/local/mysql-8.0.20 &amp;&amp; ./bin/mysqld --user=mysql --lower-case-table-names=1 --basedir=/usr/local/mysql-8.0.20/ --datadir=/usr/local/mysql-8.0.20/data/ --initialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 建立 Mysql 服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -a ./support-files/mysql.server /etc/init.d/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x /etc/init.d/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/systemd/system/mysql.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动、停止、重启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart mysql.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status mysql.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建软连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s /usr/local/mysql-8.0.20/bin/mysql /usr/bin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定 mysqld.sock 进入 MySQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -p&#x27;123456&#x27; --socket=/var/run/mysqld/mysqld.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -p&#x27;!(rv?6Y0TQs;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -p&#x27;123456&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改root权限，增加远程连接（从服务器为了安全可以不必执行）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update user set host =&#x27;%&#x27; where user=&#x27;root&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;!(rv?6Y0TQs;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">踩坑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">报错：mysql -uroot -p&#x27;!(rv?6Y0TQs;&#x27; --socket=/var/run/mysqld/mysqld.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">解决：apt-get install libtinfo5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置主从</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 主数据库创建用户 slave 并授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create user &#x27;slave&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password by &#x27;password&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant replication slave on *.* to &#x27;slave&#x27;@&#x27;%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从数据库验证slave用户是否可用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uslave -p -h&lt;主服务器IP&gt; -P3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uslave -p&#x27;password&#x27; -P3306 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 主数据库查询服务ID及Master状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询server_id是否可配置文件中一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;server_id&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若不一致，可设置临时ID（重启失效）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set global server_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询Master状态，并记录 File 和 Position 的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show master status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">从数据库中设置主数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询server_id是否可配置文件中一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show variables like &#x27;server_id&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若不一致，可设置临时ID（重启失效）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set global server_id = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置主数据库参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change master to master_host=&#x27;主数据库IP&#x27;,master_port=3306,master_user=&#x27;slave&#x27;,master_password=&#x27;password&#x27;,master_log_file=&#x27;mysql-bin.000002&#x27;,master_log_pos=156;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开始同步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若出现错误，则停止同步，重置后再次启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stop slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reset slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询Slave状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show slave status\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看是否配置成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看参数 Slave_IO_Running 和 Slave_SQL_Running 是否都为yes，则证明配置成功。若为no，则需要查看对应的 Last_IO_Error 或 Last_SQL_Error 的异常值。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>读取 sql 文件里的关键字并替换为大写的，重新写入新的 sql 文件：
<a href="https://github.com/iewiewiew/Learn-Python/tree/master/utils/replace_key_word.py" target="_blank" rel="noopener noreferrer">https://github.com/iewiewiew/Learn-Python/tree/master/utils/replace_key_word.py</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Database/InfluxDB/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">InfluxDB</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Database/PostgreSQL/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">PostgreSQL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-数据库基础" class="table-of-contents__link toc-highlight">1. 数据库基础</a></li><li><a href="#2-sql-执行详解" class="table-of-contents__link toc-highlight">2. sql 执行详解</a><ul><li><a href="#sql-执行过程" class="table-of-contents__link toc-highlight">sql 执行过程</a></li><li><a href="#sql-执行顺序" class="table-of-contents__link toc-highlight">sql 执行顺序</a></li><li><a href="#sql-编写顺序" class="table-of-contents__link toc-highlight">sql 编写顺序</a></li><li><a href="#sql-解析顺序" class="table-of-contents__link toc-highlight">sql 解析顺序</a></li><li><a href="#sql-执行关键字解释" class="table-of-contents__link toc-highlight">sql 执行关键字解释</a></li><li><a href="#sql-执行计划-explain" class="table-of-contents__link toc-highlight">sql 执行计划 explain</a></li></ul></li><li><a href="#3-数据库索引" class="table-of-contents__link toc-highlight">3. 数据库索引</a><ul><li><a href="#索引基数" class="table-of-contents__link toc-highlight">索引基数</a></li><li><a href="#索引的建立" class="table-of-contents__link toc-highlight">索引的建立</a></li><li><a href="#索引的分类" class="table-of-contents__link toc-highlight">索引的分类</a></li><li><a href="#索引的优缺点" class="table-of-contents__link toc-highlight">索引的优缺点</a></li><li><a href="#索引失效原因" class="table-of-contents__link toc-highlight">索引失效原因</a></li><li><a href="#索引建立规则" class="table-of-contents__link toc-highlight">索引建立规则</a></li><li><a href="#知识碎片" class="table-of-contents__link toc-highlight">知识碎片</a></li></ul></li><li><a href="#4-数据库日志" class="table-of-contents__link toc-highlight">4. 数据库日志</a></li><li><a href="#5-数据库监控" class="table-of-contents__link toc-highlight">5. 数据库监控</a></li><li><a href="#6-知识碎片" class="table-of-contents__link toc-highlight">6. 知识碎片</a><ul><li><a href="#mysql-vip-漂移" class="table-of-contents__link toc-highlight">MySQL VIP 漂移</a></li><li><a href="#mysql-打满连接数" class="table-of-contents__link toc-highlight">MySQL 打满连接数</a></li><li><a href="#查看-mysql-主节点" class="table-of-contents__link toc-highlight">查看 MySQL 主节点</a></li><li><a href="#锁表" class="table-of-contents__link toc-highlight">锁表</a></li><li><a href="#mysql-系统变量" class="table-of-contents__link toc-highlight">MySQL 系统变量</a></li><li><a href="#本地链接-k8s-mysql" class="table-of-contents__link toc-highlight">本地链接 K8S MySQL</a></li><li><a href="#mysql-导出查询-sql" class="table-of-contents__link toc-highlight">MySQL 导出查询 SQL</a></li><li><a href="#如何定位慢-sql" class="table-of-contents__link toc-highlight">如何定位慢 SQL</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cbea1bda.js"></script>
<script src="/assets/js/main.904b21c1.js"></script>
</body>
</html>