"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2192],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var i=a.createContext({}),o=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=o(e.components);return a.createElement(i.Provider,{value:t},e.children)},p="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=o(n),h=s,d=p["".concat(i,".").concat(h)]||p[h]||k[h]||r;return n?a.createElement(d,l(l({ref:t},u),{},{components:n})):a.createElement(d,l({ref:t},u))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,l=new Array(r);l[0]=h;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c[p]="string"==typeof e?e:s,l[1]=c;for(var o=2;o<r;o++)l[o]=n[o];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8506:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var a=n(7462),s=(n(7294),n(3905));const r={},l=void 0,c={unversionedId:"Database/ClickHouse/ClickHouse",id:"Database/ClickHouse/ClickHouse",title:"ClickHouse",description:"[TOC]",source:"@site/docs/Database/ClickHouse/ClickHouse.md",sourceDirName:"Database/ClickHouse",slug:"/Database/ClickHouse/",permalink:"/docs/Database/ClickHouse/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u6df7\u6c8c\u5de5\u7a0b",permalink:"/docs/Chaos/\u6df7\u6c8c\u5de5\u7a0b"},next:{title:"Elasticsearch",permalink:"/docs/Database/Elasticsearch"}},i={},o=[{value:"1. ClickHouse \u7b80\u4ecb",id:"1-clickhouse-\u7b80\u4ecb",level:2},{value:"2. ClickHouse \u5b89\u88c5",id:"2-clickhouse-\u5b89\u88c5",level:2},{value:"3. Clickhouse \u6559\u7a0b",id:"3-clickhouse-\u6559\u7a0b",level:2},{value:"ClickHouse SQL",id:"clickhouse-sql",level:3},{value:"Clickhouse \u57fa\u7840",id:"clickhouse-\u57fa\u7840",level:3},{value:"Clickhouse  \u76d1\u63a7",id:"clickhouse--\u76d1\u63a7",level:3},{value:"ClickHouse \u548c MySQL \u6620\u5c04",id:"clickhouse-\u548c-mysql-\u6620\u5c04",level:3},{value:"Clickhouse \u914d\u7f6e",id:"clickhouse-\u914d\u7f6e",level:3},{value:"4. \u77e5\u8bc6\u788e\u7247",id:"4-\u77e5\u8bc6\u788e\u7247",level:2}],u={toc:o},p="wrapper";function k(e){let{components:t,...r}=e;return(0,s.kt)(p,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"[TOC]"),(0,s.kt)("h1",{align:"center"},"ClickHouse"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"By\uff1aweimenghua",(0,s.kt)("br",{parentName:"p"}),"\n","Date\uff1a2023.01.19",(0,s.kt)("br",{parentName:"p"}),"\n","Descrition\uff1aClickHouse \u5217\u5f0f\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u53c2\u8003\u8d44\u6599"),(0,s.kt)("br",{parentName:"p"}),"\n",(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/"},"ClickHouse \u5b98\u65b9\u6587\u6863"),(0,s.kt)("br",{parentName:"p"}),"\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/ClickHouse"},"ClickHouse \u6e90\u7801"),(0,s.kt)("br",{parentName:"p"}),"\n",(0,s.kt)("a",{parentName:"p",href:"https://packages.clickhouse.com/"},"ClickHouse \u4e0b\u8f7d")),(0,s.kt)("h2",{id:"1-clickhouse-\u7b80\u4ecb"},"1. ClickHouse \u7b80\u4ecb"),(0,s.kt)("p",null,"ClickHouse \u662f\u4e00\u4e2a\u7528\u4e8e\u8054\u673a\u5206\u6790(OLAP)\u7684\u5217\u5f0f\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf(DBMS)\u3002"),(0,s.kt)("h2",{id:"2-clickhouse-\u5b89\u88c5"},"2. ClickHouse \u5b89\u88c5"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/getting-started/install"},"\u5b89\u88c5\u6587\u6863")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'sudo apt-get install -y apt-transport-https ca-certificates dirmngr\nsudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 8919F6BD2B48D754\n\necho "deb https://packages.clickhouse.com/deb stable main" | sudo tee \\\n    /etc/apt/sources.list.d/clickhouse.list\nsudo apt-get update\n\nsudo apt-get install -y clickhouse-server clickhouse-client\n\nsudo service clickhouse-server start\nclickhouse-client # or "clickhouse-client --password" if you\'ve set up a password.\n\n\u5bc6\u7801\u8bbe\u7f6e 123456\n\n\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e /etc/clickhouse-server/\u3002\u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u8bf7\u6ce8\u610f config.xml \u4e2d\u7684 <path> \u5143\u7d20\u3002\u5b83\u51b3\u5b9a\u4e86\u6570\u636e\u5b58\u50a8\u7684\u4f4d\u7f6e\uff0c\u56e0\u6b64\u5b83\u5e94\u8be5\u4f4d\u4e8e\u78c1\u76d8\u5bb9\u91cf\u7684\u5377\u4e0a\uff0c\u9ed8\u8ba4\u503c\u662f /var/lib/clickhouse/\u3002\n\n\u7528\u6237\u914d\u7f6e\u6587\u4ef6\uff1a/etc/clickhouse-server/users.xml\uff0c/etc/clickhouse-server/users.d/default-password.xml\n')),(0,s.kt)("p",null,"\u68c0\u67e5\u670d\u52a1"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"\u68c0\u67e5\u670d\u52a1\nnetstat -antpl | grep clickhouse\n\n\u5ba2\u6237\u7aef\u8fde\u63a5\nclickhouse-client --password 123456\n\n\u67e5\u770b\u65e5\u5fd7\ntail -500f /var/log/clickhouse-server/clickhouse-server.log\n")),(0,s.kt)("h2",{id:"3-clickhouse-\u6559\u7a0b"},"3. Clickhouse \u6559\u7a0b"),(0,s.kt)("h3",{id:"clickhouse-sql"},"ClickHouse SQL"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"\u67e5\u770b\u6570\u636e\u5e93\nSHOW DATABASES\n\n\u521b\u5efa\u6570\u636e\u5e93\nCREATE DATABASE [IF NOT EXISTS] db_name [ON CLUSTER cluster] [ENGINE = engine(...)]\nCREATE DATABASE db_name\n\n\u5220\u9664\u6570\u636e\u5e93\ndrop database [\u6570\u636e\u5e93\u540d\u79f0]\ndrop database db_name\n\n\u521b\u5efa\u6570\u636e\u8868\nCREATE TABLE db_name.table_name (\n    customer_id String, \n    time_stamp Date, \n    click_event_type String,\n    country_code FixedString(2),    \n    source_id UInt64\n) \nENGINE = MergeTree()\nORDER BY (time_stamp)\n\n\u67e5\u770b\u6570\u636e\u5e93\u4e2d\u7684\u8868\u540d\nSHOW TABLES\nSHOW TABLES IN [\u6570\u636e\u5e93\u540d\u79f0]\nSHOW TABLES IN db_name\n\n\u67e5\u770b\u8868\u7ed3\u6784 \nDESCRIBE [\u6570\u636e\u5e93.\u8868\u540d]\nDESCRIBE db_name.table_name\n\n\u63d2\u5165\u6570\u636e\nINSERT INTO [\u6570\u636e\u5e93.\u8868\u540d] VALUES ()\nINSERT INTO db_name.table_name VALUES ('customer1', '2023-01-08', 'add_to_cart', 'US', 568239)\n\n\u6307\u5b9a\u5217\u540d\u63d2\u5165 INSERT INTO [\u6570\u636e\u5e93.\u8868\u540d] (\u5217\u540d\uff0c\u5217\u540d\uff0c\u5217\u540d\uff0c\uff0c) VALUES (, , ,)\nINSERT INTO db_name.table_name (customer_id, time_stamp, click_event_type)\nVALUES ('customer2', '2023-01-08', 'remove_from_cart')\n\n\u67e5\u770b\u8868\u4e2d\u5b58\u50a8\u7684\u6570\u636e\nSELECT * FROM [\u6570\u636e\u5e93.\u8868\u540d]\nSELECT * FROM [\u6570\u636e\u5e93.\u8868\u540d] WHERE [\u5217\u540d]= \nSELECT * FROM [\u6570\u636e\u5e93.\u8868\u540d] WHERE [\u5217\u540d]>=\nSELECT [\u5217\u540d] FROM [\u6570\u636e\u5e93.\u8868\u540d] WHERE [\u5217\u540d]>=\nSELECT * FROM db_name.table_name\n\nATOMIC \u9ed8\u8ba4\u5f15\u64ce\nmysql \u5f15\u64ce,\u53ef\u4ee5\u5c06 mysql \u4e2d\u7684\u6570\u636e\u8868\u76f4\u63a5\u590d\u5236\u8fc7\u6765\u3002\nCREATE DATABASE [IF NOT EXISTS] db_name [ON CLUSTER cluster]\nENGINE = MySQL('host:port', ['database' | database], 'user', 'password')\n")),(0,s.kt)("h3",{id:"clickhouse-\u57fa\u7840"},"Clickhouse \u57fa\u7840"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/getting-started/tutorial"},"Clickhouse \u6559\u7a0b"),"  "),(0,s.kt)("p",null,"\u8fdb\u5165\u5ba2\u6237\u7aef\u65b9\u5f0f\u4e00\uff1a\nclickhouse-client --password 123456\nclickhouse-client --host=... --port=... --user=... --password=..."),(0,s.kt)("p",null,"\u8fdb\u5165\u5ba2\u6237\u7aef\u65b9\u5f0f\u4e8c\uff1a\nclickhouse-client\uff0c\u8f93\u5165\u5bc6\u7801\uff0c\u8fdb\u5165\u5ba2\u6237\u7aef\u540e\u67e5\u770b\u6570\u636e\u5e93\uff1ashow databases\uff0c\u6ce8\u610f\u547d\u4ee4\u540e\u65e0\u5206\u53f7\uff0c\u8f93\u5165\u4e4b\u540e\u6309 Enter"),(0,s.kt)("p",null,"\u4e0b\u8f7d\u5e76\u63d0\u53d6\u8868\u6570\u636e\ncurl ",(0,s.kt)("a",{parentName:"p",href:"https://datasets.clickhouse.com/hits/tsv/hits_v1.tsv.xz"},"https://datasets.clickhouse.com/hits/tsv/hits_v1.tsv.xz")," | unxz --threads=",(0,s.kt)("inlineCode",{parentName:"p"},"nproc")," > hits_v1.tsv\ncurl ",(0,s.kt)("a",{parentName:"p",href:"https://datasets.clickhouse.com/visits/tsv/visits_v1.tsv.xz"},"https://datasets.clickhouse.com/visits/tsv/visits_v1.tsv.xz")," | unxz --threads=",(0,s.kt)("inlineCode",{parentName:"p"},"nproc")," > visits_v1.tsv"),(0,s.kt)("p",null,"\u521b\u5efa\u6570\u636e\u5e93"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'clickhouse-client --password 123456 --query "CREATE DATABASE IF NOT EXISTS tutorial"\n')),(0,s.kt)("p",null,"\u521b\u5efa\u6570\u636e\u8868\n\u8fdb\u5165\u5ba2\u6237\u7aef\u540e clickhouse-client --password 123456 \u6267\u884c\u521b\u5efa\u6570\u636e\u8868\u547d\u4ee4\n",(0,s.kt)("a",{target:"_blank",href:n(4298).Z},"ClickHouse.sql")),(0,s.kt)("p",null,"\u5bfc\u5165\u6570\u636e"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'clickhouse-client --password 123456 --query "INSERT INTO tutorial.hits_v1 FORMAT TSV" --max_insert_block_size=100000 < hits_v1.tsv\nclickhouse-client --password 123456 --query "INSERT INTO tutorial.visits_v1 FORMAT TSV" --max_insert_block_size=100000 < visits_v1.tsv\n')),(0,s.kt)("p",null,"\u67e5\u8be2\u6570\u636e\u8868"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'clickhouse-client --password 123456 --query "SELECT COUNT(*) FROM tutorial.hits_v1"\nclickhouse-client --password 123456 --query "SELECT COUNT(*) FROM tutorial.visits_v1"\nclickhouse-client --password 123456 --query "SELECT * FROM tutorial.hits_v1 limit 10"\n')),(0,s.kt)("p",null,"\u4ece\u53e6\u4e00\u4e2a\u8868\u67e5\u8be2\u6570\u636e\u4ed4\u63d2\u5165\u6570\u636e\u8868"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"INSERT INTO tutorial.hits_all SELECT * FROM tutorial.hits_v1;\n")),(0,s.kt)("p",null,"\u67e5\u8be2\u7cfb\u7edf\u8bbe\u7f6e"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"SELECT name, value, changed, description FROM system.settings\nSELECT name, value, changed, description FROM system.settings WHERE name LIKE '%max_insert_b%' FORMAT TSV\nSELECT\n    name,\n    value,\n    changed,\n    description\nFROM system.settings\nWHERE name LIKE '%max_insert_b%'\n")),(0,s.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cclickhouse-server \u4f1a\u5728 8123 \u7aef\u53e3\u4e0a\u76d1\u63a7 HTTP \u8bf7\u6c42\uff08\u8fd9\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u4fee\u6539\uff09\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"curl 'http://localhost:8123/'\ncurl 'http://localhost:8123/ping'\ncurl 'http://localhost:8123/replicas_status'\n\n\u521b\u5efa\u6570\u636e\u5e93\uff08\u65e0\u5bc6\u7801\uff09\necho 'CREATE TABLE t (a UInt8) ENGINE = Memory' | curl 'http://localhost:8123/' --data-binary @-\n\u521b\u5efa\u6570\u636e\u5e93\uff08\u6709\u5bc6\u7801\uff09\necho 'CREATE TABLE t (a UInt8) ENGINE = Memory' | curl -u default:123456 'http://localhost:8123/' --data-binary @-\n\n\u521b\u5efa\u8868\uff08\u65e0\u5bc6\u7801\uff09\necho 'INSERT INTO t VALUES (1),(2),(3)' | curl 'http://localhost:8123/' --data-binary @-\n\u521b\u5efa\u8868\uff08\u6709\u5bc6\u7801\uff09\necho 'INSERT INTO t VALUES (1),(2),(3)' | curl -u default:123456 'http://localhost:8123/' --data-binary @-\n\n\u67e5\u8be2\u8868\nclickhouse-client --password 123456 --query \"SELECT * FROM default.t\"\n")),(0,s.kt)("p",null,"clickhouse \u672c\u5730\u8868\u548c\u5206\u5e03\u5f0f\u8868\u7684\u533a\u522b"),(0,s.kt)("p",null,"\u5206\u5e03\u5f0f\u8868\uff1a\u6570\u636e\u4f1a\u6839\u636e\u9884\u5b9a\u4e49\u7684\u5206\u5e03\u7b56\u7565\u5728\u591a\u4e2a\u7269\u7406\u8282\u70b9\u4e0a\u8fdb\u884c\u5206\u7247\u548c\u590d\u5236\uff0c\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u90e8\u5206\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u6570\u636e\u7684\u5206\u5e03\u548c\u5197\u4f59\uff0c\u63d0\u9ad8\u6570\u636e\u5904\u7406\u548c\u67e5\u8be2\u7684\u5e76\u884c\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002\n\u672c\u5730\u8868\uff1a\u6570\u636e\u5b58\u50a8\u5728\u5355\u4e2a\u8282\u70b9\u4e0a\uff0c\u4e0d\u8fdb\u884c\u5206\u7247\u548c\u590d\u5236\u3002\u672c\u5730\u8868\u9002\u7528\u4e8e\u5c0f\u89c4\u6a21\u6570\u636e\u96c6\u548c\u5355\u8282\u70b9\u73af\u5883\uff0c\u4ec5\u4f7f\u7528\u5355\u4e2a\u670d\u52a1\u5668\u8fdb\u884c\u6570\u636e\u5b58\u50a8\u548c\u67e5\u8be2\u3002"),(0,s.kt)("p",null,"1\u4e2a\u6216\u591a\u4e2a\u526f\u672c\uff08Replica\uff09\u30011\u4e2a\u6216\u591a\u4e2a\u5206\u7247\uff08Shard\uff09"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},(0,s.kt)("strong",{parentName:"th"},"\u7c7b\u578b")),(0,s.kt)("th",{parentName:"tr",align:null},(0,s.kt)("strong",{parentName:"th"},"\u8bf4\u660e")),(0,s.kt)("th",{parentName:"tr",align:null},(0,s.kt)("strong",{parentName:"th"},"\u533a\u522b")))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"\u672c\u5730\u8868\uff08Local Table\uff09"),(0,s.kt)("td",{parentName:"tr",align:null},"\u6570\u636e\u53ea\u4f1a\u5b58\u50a8\u5728\u5f53\u524d\u5199\u5165\u7684\u8282\u70b9\u4e0a\uff0c\u4e0d\u4f1a\u88ab\u5206\u6563\u5230\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u3002"),(0,s.kt)("td",{parentName:"tr",align:null},"\u672c\u5730\u8868\u7684\u5199\u5165\u548c\u67e5\u8be2\uff0c\u53d7\u9650\u4e8e\u5355\u53f0\u670d\u52a1\u5668\u7684\u5b58\u50a8\u3001\u8ba1\u7b97\u8d44\u6e90\uff0c\u4e0d\u5177\u5907\u6a2a\u5411\u62d3\u5c55\u80fd\u529b\u3002\u5206\u5e03\u5f0f\u8868\u7684\u5199\u5165\u548c\u67e5\u8be2\uff0c\u53ef\u4ee5\u5229\u7528\u591a\u53f0\u670d\u52a1\u5668\u7684\u5b58\u50a8\u3001\u8ba1\u7b97\u8d44\u6e90\uff0c\u5177\u6709\u8f83\u597d\u7684\u6a2a\u5411\u62d3\u5c55\u80fd\u529b\u3002")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"\u5206\u5e03\u5f0f\u8868\uff08Distributed Table\uff09"),(0,s.kt)("td",{parentName:"tr",align:null},"\u672c\u5730\u8868\u7684\u96c6\u5408\uff0c\u5b83\u5c06\u591a\u4e2a\u672c\u5730\u8868\u62bd\u8c61\u4e3a\u4e00\u5f20\u7edf\u4e00\u7684\u8868\uff0c\u5bf9\u5916\u63d0\u4f9b\u5199\u5165\u3001\u67e5\u8be2\u529f\u80fd\u3002\u5f53\u5199\u5165\u5206\u5e03\u5f0f\u8868\u65f6\uff0c\u6570\u636e\u4f1a\u88ab\u81ea\u52a8\u5206\u53d1\u5230\u96c6\u5408\u4e2d\u7684\u5404\u4e2a\u672c\u5730\u8868\u4e2d\uff1b\u5f53\u67e5\u8be2\u5206\u5e03\u5f0f\u8868\u65f6\uff0c\u96c6\u5408\u4e2d\u7684\u5404\u4e2a\u672c\u5730\u8868\u90fd\u4f1a\u88ab\u5206\u522b\u67e5\u8be2\uff0c\u5e76\u4e14\u628a\u6700\u7ec8\u7ed3\u679c\u6c47\u603b\u540e\u8fd4\u56de\u3002"),(0,s.kt)("td",{parentName:"tr",align:null})))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"-- \u521b\u5efa\u5206\u5e03\u5f0f\u8868\nCREATE TABLE example_table ON CLUSTER your_cluster_name\n(\n    id UInt32,\n    name String\n) ENGINE = MergeTree()\nORDER BY id;\n\n-- \u521b\u5efa\u672c\u5730\u8868\nCREATE TABLE example_table_local\n(\n    id UInt32,\n    name String\n) ENGINE = MergeTree()\nORDER BY id;\n\n-- \u63d2\u5165\u6570\u636e\nINSERT INTO example_table VALUES (1, 'Alice'), (2, 'Bob');\n")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/engines/table-engines"},"\u8868\u5f15\u64ce")),(0,s.kt)("p",null,'-- \u67e5\u770b\u6570\u636e\u5e93\u5f15\u64ce\nclickhouse-client --password="123456" --query "SELECT name, engine FROM system.tables WHERE database = \'tutorial\';"'),(0,s.kt)("h3",{id:"clickhouse--\u76d1\u63a7"},"Clickhouse  \u76d1\u63a7"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.ac.cn/docs/en/operations/monitoring"},"\u5185\u7f6e\u9ad8\u7ea7\u53ef\u89c2\u6d4b\u6027\u4eea\u8868\u677f"),"  "),(0,s.kt)("p",null,"\u76d1\u63a7\u4fe1\u606f\uff1a",(0,s.kt)("a",{parentName:"p",href:"http://127.0.0.1:8123/dashboard"},"http://127.0.0.1:8123/dashboard"),"  \u9ed8\u8ba4 default/123456 (\u521d\u59cb\u5316\u8bbe\u7f6e\u7684\u5bc6\u7801)"),(0,s.kt)("p",null,"\u4fee\u6539\u5185\u7f6e\u76d1\u63a7\u4eea\u8868\u76d8\u65f6\u533a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'\u67e5\u770b\u6570\u636e\u5e93\u65f6\u533a\nclickhouse-client --password 123456 --query "SELECT timezone();"\n\ncat /etc/clickhouse-server/config.xml\n\u4fee\u6539 <timezone>UTC</timezone> \u4e3a <timezone>Asia/Shanghai</timezone>\n\n\u91cd\u542f\u670d\u52a1\nservice clickhouse-server restart\nservice clickhouse-server status\n')),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"../../SoftwareTest/%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/Prometheus+Grafana"},"Grafana+Prometheus \u76d1\u63a7")),(0,s.kt)("p",null,"curl http://localhost:9363/metrics|less"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/operations/server-configuration-parameters/settings#server_configuration_parameters-prometheus"},"https://clickhouse.com/docs/zh/operations/server-configuration-parameters/settings#server_configuration_parameters-prometheus")),(0,s.kt)("p",null,"\u6a21\u677fID\uff1a14192\uff08\u63a8\u8350\uff09"),(0,s.kt)("p",null,"\u641c\u7d22 Clickhouse \u6a21\u677f\n",(0,s.kt)("a",{parentName:"p",href:"https://grafana.com/grafana/dashboards/?search=clickhouse"},"https://grafana.com/grafana/dashboards/?search=clickhouse")),(0,s.kt)("p",null,"\u5728 Grafana \u5bfc\u5165 Clickhouse \u6a21\u677f"),(0,s.kt)("p",null,"\u8e29\u5751\uff1aGrafana \u9762\u677f\u65e0\u6cd5\u5c55\u793a Clickhouse \u6570\u636e\n\u539f\u56e0\uff1a\u6570\u636e\u6e90\u662f\u5199\u7684\u56fa\u5b9a\u7684\uff0c\u5982\u679c\u5f53\u524d\u8981\u663e\u793a\u7684\u76d1\u63a7\u6570\u636e\u7684\u6570\u636e\u6e90\u540d\u79f0\u8ddf\u8fd9\u4e2a\u4e0d\u540c\uff0c\u5c31\u4f1a\u62a5\u9519\u3002\n\u89e3\u51b3\uff1a\u5c06 json \u6587\u4ef6\u4e2d\u6240\u6709\u7684 uid\u66f4\u6362\u4e3a\u5f53\u524d\u76d1\u63a7\u6570\u636e\u7684\u6570\u636e\u6e90\u540d\u79f0\uff0c\u7136\u540e\u518d\u5c06\u5176\u5bfc\u5165\uff0c\u4f8b\u5982\uff1aprometheus"),(0,s.kt)("h3",{id:"clickhouse-\u548c-mysql-\u6620\u5c04"},(0,s.kt)("a",{parentName:"h3",href:"https://clickhouse.com/docs/zh/engines/database-engines/mysql"},"ClickHouse \u548c MySQL \u6620\u5c04")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"\u5728 MySQL \u521b\u5efa\u6570\u636e\u5e93 existing_database\nCREATE DATABASE existing_database;\n\n\u5728 MySQL \u6570\u636e\u5e93 existing_database \u521b\u5efa\u6570\u636e\u8868 mysql_table\nCREATE TABLE existing_database.`mysql_table` (\n`int_id` INT NOT NULL AUTO_INCREMENT,\n`float` FLOAT NOT NULL,\nPRIMARY KEY (`int_id`));\n\n\u5728 MySQL \u6570\u636e\u5e93 existing_database \u6570\u636e\u8868 mysql_table \u63d2\u5165\u6570\u636e\ninsert into existing_database.mysql_table (`int_id`, `float`) VALUES (1,2);\n\nClickHouse \u548c MySQL \u6620\u5c04\nCREATE DATABASE [IF NOT EXISTS] db_name [ON CLUSTER cluster] ENGINE = MySQL('host:port', ['database' | database], 'user', 'password')\nCREATE DATABASE IF NOT EXISTS db_name ENGINE = MySQL('114.67.240.27:3306', 'existing_database', 'root', '123456')\n- host:port \u2014 MySQL\u670d\u52a1\u5730\u5740\n- database \u2014 MySQL\u6570\u636e\u5e93\u540d\u79f0\n- user \u2014 MySQL\u7528\u6237\u540d\n- password \u2014 MySQL\u7528\u6237\u5bc6\u7801\n\n\u5728 ClickHouse \u67e5\u8be2\u6570\u636e\u8868\nclickhouse-client --password 123456 --query \"SELECT * FROM db_name.mysql_table\"\n\n\u5728 ClickHouse \u63d2\u5165\u6570\u636e\u8868\nclickhouse-client --password 123456 --query \"INSERT db_name.mysql_table (`int_id`, `float`) VALUES (3,4)\"\n")),(0,s.kt)("h3",{id:"clickhouse-\u914d\u7f6e"},"Clickhouse \u914d\u7f6e"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/zh/engines/table-engines/special/distributed"},"\u5206\u5e03\u5f0f\u5f15\u64ce")),(0,s.kt)("p",null,"\u5728 /etc/clickhouse-server/config.xml \u8bbe\u7f6e\u5206\u533a replica"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"<macros>\n    <shard>01</shard>\n    <replica>02</replica>\n</macros>\n\n- <shard>\uff1a \u8868\u793a\u5f53\u524d\u5206\u7247\u7684\u6807\u8bc6\u7b26\u3002\u5206\u7247\u662f ClickHouse \u4e2d\u7684\u4e00\u4e2a\u57fa\u672c\u5355\u5143\uff0c\u5206\u7247\u5c06\u6570\u636e\u5206\u5e03\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4ee5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u548c\u9ad8\u53ef\u7528\u6027\u3002\u4f8b\u5982\uff0c<shard>01</shard> \u4ee3\u8868\u8fd9\u662f\u7b2c\u4e00\u4e2a\uff08\u6216\u7f16\u53f7\u4e3a 01 \u7684\uff09\u5206\u7247\u3002\n- <replica>\uff1a \u8868\u793a\u5f53\u524d\u526f\u672c\u7684\u6807\u8bc6\u7b26\u3002\u526f\u672c\u662f\u5206\u7247\u7684\u4e00\u4e2a\u62f7\u8d1d\uff0c\u786e\u4fdd\u4e86\u6570\u636e\u7684\u5197\u4f59\u548c\u9ad8\u53ef\u7528\u6027\u3002\u4f8b\u5982\uff0c<replica>02</replica> \u4ee3\u8868\u8fd9\u662f\u7b2c\u4e8c\u4e2a\uff08\u6216\u7f16\u53f7\u4e3a 02 \u7684\uff09\u526f\u672c\u3002\n\n<shard>\n    \x3c!-- \u53ef\u9009\u7684\u3002\u5199\u6570\u636e\u65f6\u5206\u7247\u6743\u91cd\u3002 \u9ed8\u8ba4: 1. --\x3e\n    <weight>1</weight>\n    \x3c!-- \u53ef\u9009\u7684\u3002\u662f\u5426\u53ea\u5c06\u6570\u636e\u5199\u5165\u5176\u4e2d\u4e00\u4e2a\u526f\u672c\u3002\u9ed8\u8ba4\u503c:false(\u5c06\u6570\u636e\u5199\u5165\u6240\u6709\u526f\u672c)\u3002 --\x3e\n    <internal_replication>false</internal_replication>\n    <replica>\n        \x3c!-- \u53ef\u9009\u7684\u3002\u8d1f\u8f7d\u5747\u8861\u526f\u672c\u7684\u4f18\u5148\u7ea7\uff0c\u8bf7\u53c2\u89c1\uff08load_balancing \u8bbe\u7f6e)\u3002\u9ed8\u8ba4\u503c:1(\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8)\u3002 --\x3e\n        <priority>1</priority>\n        <host>example01-01-1</host>\n        <port>9000</port>\n    </replica>\n    <replica>\n        <host>example01-01-2</host>\n        <port>9000</port>\n    </replica>\n</shard>\n<shard>\n    <weight>2</weight>\n    <internal_replication>false</internal_replication>\n    <replica>\n        <host>example01-02-1</host>\n        <port>9000</port>\n    </replica>\n    <replica>\n        <host>example01-02-2</host>\n        <secure>1</secure>\n        <port>9440</port>\n    </replica>\n</shard>\n")),(0,s.kt)("p",null,"<interserver_http_host> \u53c2\u6570\u7528\u4e8e\u914d\u7f6e\u96c6\u7fa4\u4e2d\u670d\u52a1\u5668\u4e4b\u95f4\u7684 HTTP \u901a\u4fe1\u3002"),(0,s.kt)("p",null,"\u5141\u8bb8\u5916\u7f51\u8bbf\u95ee\u9700\u4fee\u6539\u5982\u4e0b\u914d\u7f6e\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"vim /etc/clickhouse-server/config.xml \u53bb\u6389\u4e0b\u65b9\u914d\u7f6e\u7684\u6ce8\u91ca\n\n<listen_host>0.0.0.0</listen_host>\n\n\u91cd\u542f\u670d\u52a1\nservice clickhouse-server restart\n")),(0,s.kt)("p",null,"vim /etc/clickhouse-server/config.xml, \u5c06 prometheus \u8fd9\u4e00\u9879\u539f\u5148\u7684\u6ce8\u91ca\u653e\u5f00\uff0c\u4f7f\u5176\u751f\u6548\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"<prometheus>\n    <endpoint>/metrics</endpoint>\n    <port>9363</port>\n\n    <metrics>true</metrics>\n    <events>true</events>\n    <asynchronous_metrics>true</asynchronous_metrics>\n</iprometheus>\n")),(0,s.kt)("h2",{id:"4-\u77e5\u8bc6\u788e\u7247"},"4. \u77e5\u8bc6\u788e\u7247"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'-- \u67e5\u8be2\u65e5\u5fd7\nselect query_id,\nProfileEvents[\'QueryCacheHits\']   AS query_cache,\nquery_duration_ms / 1000          AS query_duration,\nformatReadableSize(memory_usage)  AS memory_usage,\nformatReadableQuantity(read_rows) AS read_rows,\nformatReadableSize(read_bytes)    AS read_data\nfrom system.query_log\n\n-- \u67e5\u8be2\u65f6\u533a\nclickhouse-client --password 123456 --query "SELECT timezone();"\n\n-- \u6b64\u7cfb\u7edf\u8868\u5305\u542b\u53ef\u4ee5\u5373\u65f6\u8ba1\u7b97\u6216\u5177\u6709\u5f53\u524d\u503c\u7684\u6307\u6807\u3002\u4f8b\u5982\uff0c\u540c\u65f6\u5904\u7406\u7684\u67e5\u8be2\u6570\u91cf\u6216\u5f53\u524d\u7684\u590d\u5236\u5ef6\u8fdf\u3002\u8fd9\u4e2a\u8868\u59cb\u7ec8\u662f\u6700\u65b0\u7684\nclickhouse-client --password 123456 --query "SELECT * FROM system.metrics;"\n\n-- \u5f85\u5b9a\nclickhouse-client --password 123456 --query "SELECT * from system.tables;"\n\n-- \u67e5\u8be2\u526f\u672c\nclickhouse-client --password 123456 --query "SELECT * from system.replicas"\nclickhouse-client --password 123456 --query "SELECT database, table, engine, zookeeper_path, replica_path from system.replicas"\nclickhouse-client --password 123456 --query "desc system.replicas"\n\n-- \u67e5\u8be2\u96c6\u7fa4\nclickhouse-client --password 123456 --query "select * from system.clusters;"\nclickhouse-client --password 123456\nSELECT\n    cluster,\n    shard_num,\n    replica_num,\n    host_name,\n    is_local,\n    user,\n    database_shard_name,\n    database_replica_name\nFROM system.clusters\nclickhouse-client --password 123456 --query "SHOW CLUSTERS"\n')),(0,s.kt)("p",null,'clickhouse-client --password="123456" --query "SHOW databases"'),(0,s.kt)("p",null,"clickhouse-client --password 123456"))}k.isMDXComponent=!0},4298:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/ClickHouse-8d9c8fcc752f7860487f49c32d15f240.sql"}}]);